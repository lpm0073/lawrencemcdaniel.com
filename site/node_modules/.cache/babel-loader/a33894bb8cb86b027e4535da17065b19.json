{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _extends = Object.assign || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n\n  return target;\n};\n\nexports.default = changeActionReducer;\n\nvar _actionTypes = require('../../action-types');\n\nvar _actionTypes2 = _interopRequireDefault(_actionTypes);\n\nvar _icepick = require('icepick');\n\nvar _icepick2 = _interopRequireDefault(_icepick);\n\nvar _get = require('../../utils/get');\n\nvar _get2 = _interopRequireDefault(_get);\n\nvar _shallowEqual = require('../../utils/shallow-equal');\n\nvar _shallowEqual2 = _interopRequireDefault(_shallowEqual);\n\nvar _isPlainObject = require('../../utils/is-plain-object');\n\nvar _isPlainObject2 = _interopRequireDefault(_isPlainObject);\n\nvar _mapValues = require('../../utils/map-values');\n\nvar _mapValues2 = _interopRequireDefault(_mapValues);\n\nvar _formReducer = require('../form-reducer');\n\nvar _initialFieldState = require('../../constants/initial-field-state');\n\nvar _initialFieldState2 = _interopRequireDefault(_initialFieldState);\n\nvar _assocIn = require('../../utils/assoc-in');\n\nvar _assocIn2 = _interopRequireDefault(_assocIn);\n\nvar _getFormValue = require('../../utils/get-form-value');\n\nvar _getFormValue2 = _interopRequireDefault(_getFormValue);\n\nvar _invariant = require('invariant');\n\nvar _invariant2 = _interopRequireDefault(_invariant);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction updateFieldValue(field, action) {\n  var parentModel = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : undefined;\n  var value = action.value,\n      removeKeys = action.removeKeys,\n      silent = action.silent,\n      load = action.load,\n      model = action.model,\n      external = action.external;\n  var fieldState = field && field.$form ? field.$form : field;\n  var changedFieldProps = {\n    validated: false,\n    retouched: fieldState.submitted ? true : fieldState.retouched,\n    // If change originated from Control component (not externally),\n    // then there is no need to remind Control to validate itself.\n    intents: external ? [{\n      type: 'validate'\n    }] : [],\n    pristine: silent ? fieldState.pristine : false,\n    value: value,\n    loadedValue: load ? value : fieldState.loadedValue\n  };\n\n  if ((0, _shallowEqual2.default)(field.value, value)) {\n    return _icepick2.default.merge(field, changedFieldProps);\n  }\n\n  if (removeKeys) {\n    (0, _invariant2.default)(field && field.$form, 'Unable to remove keys. ' + 'Field for \"%s\" in store is not an array/object.', model);\n    var valueIsArray = Array.isArray(field.$form.value);\n    var removeKeysArray = Array.isArray(removeKeys) ? removeKeys : [removeKeys];\n    var result = void 0;\n\n    if (valueIsArray) {\n      result = [];\n      Object.keys(field).forEach(function (key) {\n        if (!!~removeKeysArray.indexOf(+key) || key === '$form') return;\n        result[key] = _extends({}, field[key]);\n      });\n\n      var finalResult = _extends({}, result.filter(function (f) {\n        return f;\n      }).map(function (subField, index) {\n        return _extends({}, subField, {\n          model: model + '.' + index\n        });\n      }));\n\n      finalResult.$form = field.$form;\n      return finalResult;\n    }\n\n    result = _extends({}, field);\n    Object.keys(field).forEach(function (key) {\n      if (!!~removeKeysArray.indexOf(key)) {\n        delete result['' + key];\n      }\n    });\n    return result;\n  }\n\n  if (!Array.isArray(value) && !(0, _isPlainObject2.default)(value)) {\n    return _icepick2.default.merge(field, _icepick2.default.set(changedFieldProps, 'value', value));\n  }\n\n  var updatedField = (0, _mapValues2.default)(value, function (subValue, index) {\n    // TODO: refactor\n    var subField = field[index] || (0, _formReducer.createInitialState)('' + (parentModel ? parentModel + '.' : '') + model + '.' + index, subValue);\n\n    if (Object.hasOwnProperty.call(subField, '$form')) {\n      return updateFieldValue(subField, {\n        model: index,\n        value: subValue,\n        external: external,\n        silent: silent,\n        load: load\n      }, parentModel ? parentModel + '.' + model : model);\n    }\n\n    if ((0, _shallowEqual2.default)(subValue, subField.value)) {\n      return subField;\n    }\n\n    return _icepick2.default.merge(subField, _icepick2.default.assign(changedFieldProps, {\n      value: subValue,\n      loadedValue: load ? subValue : subField.loadedValue\n    }));\n  });\n\n  var dirtyFormState = _icepick2.default.merge(field.$form || _initialFieldState2.default, _icepick2.default.set(changedFieldProps, 'retouched', field.submitted || field.$form && field.$form.retouched));\n\n  return _icepick2.default.set(updatedField, '$form', dirtyFormState);\n}\n\nfunction changeActionReducer(state, action, localPath) {\n  if (action.type !== _actionTypes2.default.CHANGE) return state;\n  var field = (0, _get2.default)(state, localPath, (0, _formReducer.createInitialState)(action.model, action.value));\n  var updatedField = updateFieldValue(field, action);\n  if (!localPath.length) return updatedField;\n  var updatedState = (0, _assocIn2.default)(state, localPath, updatedField, function (form) {\n    if (!form.$form) return form;\n    var formValue = (0, _getFormValue2.default)(form);\n\n    var formUpdates = _extends({}, form.$form, {\n      value: formValue\n    });\n\n    if (action.silent) {\n      formUpdates.loadedValue = formValue;\n    } else {\n      formUpdates.pristine = false;\n    }\n\n    return _extends({}, form, {\n      $form: formUpdates\n    });\n  });\n  return updatedState;\n}","map":{"version":3,"sources":["/Users/mcdaniel/github/lpm0073/lawrencemcdaniel.com/site/node_modules/react-redux-form/lib/reducers/form/change-action-reducer.js"],"names":["Object","defineProperty","exports","value","_extends","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","default","changeActionReducer","_actionTypes","require","_actionTypes2","_interopRequireDefault","_icepick","_icepick2","_get","_get2","_shallowEqual","_shallowEqual2","_isPlainObject","_isPlainObject2","_mapValues","_mapValues2","_formReducer","_initialFieldState","_initialFieldState2","_assocIn","_assocIn2","_getFormValue","_getFormValue2","_invariant","_invariant2","obj","__esModule","updateFieldValue","field","action","parentModel","undefined","removeKeys","silent","load","model","external","fieldState","$form","changedFieldProps","validated","retouched","submitted","intents","type","pristine","loadedValue","merge","valueIsArray","Array","isArray","removeKeysArray","result","keys","forEach","indexOf","finalResult","filter","f","map","subField","index","set","updatedField","subValue","createInitialState","dirtyFormState","state","localPath","CHANGE","updatedState","form","formValue","formUpdates"],"mappings":"AAAA;;AAEAA,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;AAC3CC,EAAAA,KAAK,EAAE;AADoC,CAA7C;;AAIA,IAAIC,QAAQ,GAAGJ,MAAM,CAACK,MAAP,IAAiB,UAAUC,MAAV,EAAkB;AAAE,OAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGC,SAAS,CAACC,MAA9B,EAAsCF,CAAC,EAAvC,EAA2C;AAAE,QAAIG,MAAM,GAAGF,SAAS,CAACD,CAAD,CAAtB;;AAA2B,SAAK,IAAII,GAAT,IAAgBD,MAAhB,EAAwB;AAAE,UAAIV,MAAM,CAACY,SAAP,CAAiBC,cAAjB,CAAgCC,IAAhC,CAAqCJ,MAArC,EAA6CC,GAA7C,CAAJ,EAAuD;AAAEL,QAAAA,MAAM,CAACK,GAAD,CAAN,GAAcD,MAAM,CAACC,GAAD,CAApB;AAA4B;AAAE;AAAE;;AAAC,SAAOL,MAAP;AAAgB,CAAhQ;;AAEAJ,OAAO,CAACa,OAAR,GAAkBC,mBAAlB;;AAEA,IAAIC,YAAY,GAAGC,OAAO,CAAC,oBAAD,CAA1B;;AAEA,IAAIC,aAAa,GAAGC,sBAAsB,CAACH,YAAD,CAA1C;;AAEA,IAAII,QAAQ,GAAGH,OAAO,CAAC,SAAD,CAAtB;;AAEA,IAAII,SAAS,GAAGF,sBAAsB,CAACC,QAAD,CAAtC;;AAEA,IAAIE,IAAI,GAAGL,OAAO,CAAC,iBAAD,CAAlB;;AAEA,IAAIM,KAAK,GAAGJ,sBAAsB,CAACG,IAAD,CAAlC;;AAEA,IAAIE,aAAa,GAAGP,OAAO,CAAC,2BAAD,CAA3B;;AAEA,IAAIQ,cAAc,GAAGN,sBAAsB,CAACK,aAAD,CAA3C;;AAEA,IAAIE,cAAc,GAAGT,OAAO,CAAC,6BAAD,CAA5B;;AAEA,IAAIU,eAAe,GAAGR,sBAAsB,CAACO,cAAD,CAA5C;;AAEA,IAAIE,UAAU,GAAGX,OAAO,CAAC,wBAAD,CAAxB;;AAEA,IAAIY,WAAW,GAAGV,sBAAsB,CAACS,UAAD,CAAxC;;AAEA,IAAIE,YAAY,GAAGb,OAAO,CAAC,iBAAD,CAA1B;;AAEA,IAAIc,kBAAkB,GAAGd,OAAO,CAAC,qCAAD,CAAhC;;AAEA,IAAIe,mBAAmB,GAAGb,sBAAsB,CAACY,kBAAD,CAAhD;;AAEA,IAAIE,QAAQ,GAAGhB,OAAO,CAAC,sBAAD,CAAtB;;AAEA,IAAIiB,SAAS,GAAGf,sBAAsB,CAACc,QAAD,CAAtC;;AAEA,IAAIE,aAAa,GAAGlB,OAAO,CAAC,4BAAD,CAA3B;;AAEA,IAAImB,cAAc,GAAGjB,sBAAsB,CAACgB,aAAD,CAA3C;;AAEA,IAAIE,UAAU,GAAGpB,OAAO,CAAC,WAAD,CAAxB;;AAEA,IAAIqB,WAAW,GAAGnB,sBAAsB,CAACkB,UAAD,CAAxC;;AAEA,SAASlB,sBAAT,CAAgCoB,GAAhC,EAAqC;AAAE,SAAOA,GAAG,IAAIA,GAAG,CAACC,UAAX,GAAwBD,GAAxB,GAA8B;AAAEzB,IAAAA,OAAO,EAAEyB;AAAX,GAArC;AAAwD;;AAE/F,SAASE,gBAAT,CAA0BC,KAA1B,EAAiCC,MAAjC,EAAyC;AACvC,MAAIC,WAAW,GAAGrC,SAAS,CAACC,MAAV,GAAmB,CAAnB,IAAwBD,SAAS,CAAC,CAAD,CAAT,KAAiBsC,SAAzC,GAAqDtC,SAAS,CAAC,CAAD,CAA9D,GAAoEsC,SAAtF;AACA,MAAI3C,KAAK,GAAGyC,MAAM,CAACzC,KAAnB;AAAA,MACI4C,UAAU,GAAGH,MAAM,CAACG,UADxB;AAAA,MAEIC,MAAM,GAAGJ,MAAM,CAACI,MAFpB;AAAA,MAGIC,IAAI,GAAGL,MAAM,CAACK,IAHlB;AAAA,MAIIC,KAAK,GAAGN,MAAM,CAACM,KAJnB;AAAA,MAKIC,QAAQ,GAAGP,MAAM,CAACO,QALtB;AAQA,MAAIC,UAAU,GAAGT,KAAK,IAAIA,KAAK,CAACU,KAAf,GAAuBV,KAAK,CAACU,KAA7B,GAAqCV,KAAtD;AAEA,MAAIW,iBAAiB,GAAG;AACtBC,IAAAA,SAAS,EAAE,KADW;AAEtBC,IAAAA,SAAS,EAAEJ,UAAU,CAACK,SAAX,GAAuB,IAAvB,GAA8BL,UAAU,CAACI,SAF9B;AAGtB;AACA;AACAE,IAAAA,OAAO,EAAEP,QAAQ,GAAG,CAAC;AAAEQ,MAAAA,IAAI,EAAE;AAAR,KAAD,CAAH,GAA4B,EALvB;AAMtBC,IAAAA,QAAQ,EAAEZ,MAAM,GAAGI,UAAU,CAACQ,QAAd,GAAyB,KANnB;AAOtBzD,IAAAA,KAAK,EAAEA,KAPe;AAQtB0D,IAAAA,WAAW,EAAEZ,IAAI,GAAG9C,KAAH,GAAWiD,UAAU,CAACS;AARjB,GAAxB;;AAWA,MAAI,CAAC,GAAGnC,cAAc,CAACX,OAAnB,EAA4B4B,KAAK,CAACxC,KAAlC,EAAyCA,KAAzC,CAAJ,EAAqD;AACnD,WAAOmB,SAAS,CAACP,OAAV,CAAkB+C,KAAlB,CAAwBnB,KAAxB,EAA+BW,iBAA/B,CAAP;AACD;;AAED,MAAIP,UAAJ,EAAgB;AACd,KAAC,GAAGR,WAAW,CAACxB,OAAhB,EAAyB4B,KAAK,IAAIA,KAAK,CAACU,KAAxC,EAA+C,4BAA4B,iDAA3E,EAA8HH,KAA9H;AAEA,QAAIa,YAAY,GAAGC,KAAK,CAACC,OAAN,CAActB,KAAK,CAACU,KAAN,CAAYlD,KAA1B,CAAnB;AACA,QAAI+D,eAAe,GAAGF,KAAK,CAACC,OAAN,CAAclB,UAAd,IAA4BA,UAA5B,GAAyC,CAACA,UAAD,CAA/D;AAEA,QAAIoB,MAAM,GAAG,KAAK,CAAlB;;AAEA,QAAIJ,YAAJ,EAAkB;AAChBI,MAAAA,MAAM,GAAG,EAAT;AAEAnE,MAAAA,MAAM,CAACoE,IAAP,CAAYzB,KAAZ,EAAmB0B,OAAnB,CAA2B,UAAU1D,GAAV,EAAe;AACxC,YAAI,CAAC,CAAC,CAACuD,eAAe,CAACI,OAAhB,CAAwB,CAAC3D,GAAzB,CAAH,IAAoCA,GAAG,KAAK,OAAhD,EAAyD;AAEzDwD,QAAAA,MAAM,CAACxD,GAAD,CAAN,GAAcP,QAAQ,CAAC,EAAD,EAAKuC,KAAK,CAAChC,GAAD,CAAV,CAAtB;AACD,OAJD;;AAMA,UAAI4D,WAAW,GAAGnE,QAAQ,CAAC,EAAD,EAAK+D,MAAM,CAACK,MAAP,CAAc,UAAUC,CAAV,EAAa;AACxD,eAAOA,CAAP;AACD,OAF8B,EAE5BC,GAF4B,CAExB,UAAUC,QAAV,EAAoBC,KAApB,EAA2B;AAChC,eAAOxE,QAAQ,CAAC,EAAD,EAAKuE,QAAL,EAAe;AAC5BzB,UAAAA,KAAK,EAAEA,KAAK,GAAG,GAAR,GAAc0B;AADO,SAAf,CAAf;AAGD,OAN8B,CAAL,CAA1B;;AAQAL,MAAAA,WAAW,CAAClB,KAAZ,GAAoBV,KAAK,CAACU,KAA1B;AAEA,aAAOkB,WAAP;AACD;;AAEDJ,IAAAA,MAAM,GAAG/D,QAAQ,CAAC,EAAD,EAAKuC,KAAL,CAAjB;AAEA3C,IAAAA,MAAM,CAACoE,IAAP,CAAYzB,KAAZ,EAAmB0B,OAAnB,CAA2B,UAAU1D,GAAV,EAAe;AACxC,UAAI,CAAC,CAAC,CAACuD,eAAe,CAACI,OAAhB,CAAwB3D,GAAxB,CAAP,EAAqC;AACnC,eAAOwD,MAAM,CAAC,KAAKxD,GAAN,CAAb;AACD;AACF,KAJD;AAMA,WAAOwD,MAAP;AACD;;AAED,MAAI,CAACH,KAAK,CAACC,OAAN,CAAc9D,KAAd,CAAD,IAAyB,CAAC,CAAC,GAAGyB,eAAe,CAACb,OAApB,EAA6BZ,KAA7B,CAA9B,EAAmE;AACjE,WAAOmB,SAAS,CAACP,OAAV,CAAkB+C,KAAlB,CAAwBnB,KAAxB,EAA+BrB,SAAS,CAACP,OAAV,CAAkB8D,GAAlB,CAAsBvB,iBAAtB,EAAyC,OAAzC,EAAkDnD,KAAlD,CAA/B,CAAP;AACD;;AAED,MAAI2E,YAAY,GAAG,CAAC,GAAGhD,WAAW,CAACf,OAAhB,EAAyBZ,KAAzB,EAAgC,UAAU4E,QAAV,EAAoBH,KAApB,EAA2B;AAC5E;AACA,QAAID,QAAQ,GAAGhC,KAAK,CAACiC,KAAD,CAAL,IAAgB,CAAC,GAAG7C,YAAY,CAACiD,kBAAjB,EAAqC,MAAMnC,WAAW,GAAGA,WAAW,GAAG,GAAjB,GAAuB,EAAxC,IAA8CK,KAA9C,GAAsD,GAAtD,GAA4D0B,KAAjG,EAAwGG,QAAxG,CAA/B;;AAEA,QAAI/E,MAAM,CAACa,cAAP,CAAsBC,IAAtB,CAA2B6D,QAA3B,EAAqC,OAArC,CAAJ,EAAmD;AACjD,aAAOjC,gBAAgB,CAACiC,QAAD,EAAW;AAChCzB,QAAAA,KAAK,EAAE0B,KADyB;AAEhCzE,QAAAA,KAAK,EAAE4E,QAFyB;AAGhC5B,QAAAA,QAAQ,EAAEA,QAHsB;AAIhCH,QAAAA,MAAM,EAAEA,MAJwB;AAKhCC,QAAAA,IAAI,EAAEA;AAL0B,OAAX,EAMpBJ,WAAW,GAAGA,WAAW,GAAG,GAAd,GAAoBK,KAAvB,GAA+BA,KANtB,CAAvB;AAOD;;AAED,QAAI,CAAC,GAAGxB,cAAc,CAACX,OAAnB,EAA4BgE,QAA5B,EAAsCJ,QAAQ,CAACxE,KAA/C,CAAJ,EAA2D;AACzD,aAAOwE,QAAP;AACD;;AAED,WAAOrD,SAAS,CAACP,OAAV,CAAkB+C,KAAlB,CAAwBa,QAAxB,EAAkCrD,SAAS,CAACP,OAAV,CAAkBV,MAAlB,CAAyBiD,iBAAzB,EAA4C;AACnFnD,MAAAA,KAAK,EAAE4E,QAD4E;AAEnFlB,MAAAA,WAAW,EAAEZ,IAAI,GAAG8B,QAAH,GAAcJ,QAAQ,CAACd;AAF2C,KAA5C,CAAlC,CAAP;AAID,GAtBkB,CAAnB;;AAwBA,MAAIoB,cAAc,GAAG3D,SAAS,CAACP,OAAV,CAAkB+C,KAAlB,CAAwBnB,KAAK,CAACU,KAAN,IAAepB,mBAAmB,CAAClB,OAA3D,EAAoEO,SAAS,CAACP,OAAV,CAAkB8D,GAAlB,CAAsBvB,iBAAtB,EAAyC,WAAzC,EAAsDX,KAAK,CAACc,SAAN,IAAmBd,KAAK,CAACU,KAAN,IAAeV,KAAK,CAACU,KAAN,CAAYG,SAApG,CAApE,CAArB;;AAEA,SAAOlC,SAAS,CAACP,OAAV,CAAkB8D,GAAlB,CAAsBC,YAAtB,EAAoC,OAApC,EAA6CG,cAA7C,CAAP;AACD;;AAED,SAASjE,mBAAT,CAA6BkE,KAA7B,EAAoCtC,MAApC,EAA4CuC,SAA5C,EAAuD;AACrD,MAAIvC,MAAM,CAACe,IAAP,KAAgBxC,aAAa,CAACJ,OAAd,CAAsBqE,MAA1C,EAAkD,OAAOF,KAAP;AAElD,MAAIvC,KAAK,GAAG,CAAC,GAAGnB,KAAK,CAACT,OAAV,EAAmBmE,KAAnB,EAA0BC,SAA1B,EAAqC,CAAC,GAAGpD,YAAY,CAACiD,kBAAjB,EAAqCpC,MAAM,CAACM,KAA5C,EAAmDN,MAAM,CAACzC,KAA1D,CAArC,CAAZ;AAEA,MAAI2E,YAAY,GAAGpC,gBAAgB,CAACC,KAAD,EAAQC,MAAR,CAAnC;AAEA,MAAI,CAACuC,SAAS,CAAC1E,MAAf,EAAuB,OAAOqE,YAAP;AAEvB,MAAIO,YAAY,GAAG,CAAC,GAAGlD,SAAS,CAACpB,OAAd,EAAuBmE,KAAvB,EAA8BC,SAA9B,EAAyCL,YAAzC,EAAuD,UAAUQ,IAAV,EAAgB;AACxF,QAAI,CAACA,IAAI,CAACjC,KAAV,EAAiB,OAAOiC,IAAP;AAEjB,QAAIC,SAAS,GAAG,CAAC,GAAGlD,cAAc,CAACtB,OAAnB,EAA4BuE,IAA5B,CAAhB;;AAEA,QAAIE,WAAW,GAAGpF,QAAQ,CAAC,EAAD,EAAKkF,IAAI,CAACjC,KAAV,EAAiB;AACzClD,MAAAA,KAAK,EAAEoF;AADkC,KAAjB,CAA1B;;AAIA,QAAI3C,MAAM,CAACI,MAAX,EAAmB;AACjBwC,MAAAA,WAAW,CAAC3B,WAAZ,GAA0B0B,SAA1B;AACD,KAFD,MAEO;AACLC,MAAAA,WAAW,CAAC5B,QAAZ,GAAuB,KAAvB;AACD;;AAED,WAAOxD,QAAQ,CAAC,EAAD,EAAKkF,IAAL,EAAW;AACxBjC,MAAAA,KAAK,EAAEmC;AADiB,KAAX,CAAf;AAGD,GAlBkB,CAAnB;AAoBA,SAAOH,YAAP;AACD","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\nexports.default = changeActionReducer;\n\nvar _actionTypes = require('../../action-types');\n\nvar _actionTypes2 = _interopRequireDefault(_actionTypes);\n\nvar _icepick = require('icepick');\n\nvar _icepick2 = _interopRequireDefault(_icepick);\n\nvar _get = require('../../utils/get');\n\nvar _get2 = _interopRequireDefault(_get);\n\nvar _shallowEqual = require('../../utils/shallow-equal');\n\nvar _shallowEqual2 = _interopRequireDefault(_shallowEqual);\n\nvar _isPlainObject = require('../../utils/is-plain-object');\n\nvar _isPlainObject2 = _interopRequireDefault(_isPlainObject);\n\nvar _mapValues = require('../../utils/map-values');\n\nvar _mapValues2 = _interopRequireDefault(_mapValues);\n\nvar _formReducer = require('../form-reducer');\n\nvar _initialFieldState = require('../../constants/initial-field-state');\n\nvar _initialFieldState2 = _interopRequireDefault(_initialFieldState);\n\nvar _assocIn = require('../../utils/assoc-in');\n\nvar _assocIn2 = _interopRequireDefault(_assocIn);\n\nvar _getFormValue = require('../../utils/get-form-value');\n\nvar _getFormValue2 = _interopRequireDefault(_getFormValue);\n\nvar _invariant = require('invariant');\n\nvar _invariant2 = _interopRequireDefault(_invariant);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction updateFieldValue(field, action) {\n  var parentModel = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : undefined;\n  var value = action.value,\n      removeKeys = action.removeKeys,\n      silent = action.silent,\n      load = action.load,\n      model = action.model,\n      external = action.external;\n\n\n  var fieldState = field && field.$form ? field.$form : field;\n\n  var changedFieldProps = {\n    validated: false,\n    retouched: fieldState.submitted ? true : fieldState.retouched,\n    // If change originated from Control component (not externally),\n    // then there is no need to remind Control to validate itself.\n    intents: external ? [{ type: 'validate' }] : [],\n    pristine: silent ? fieldState.pristine : false,\n    value: value,\n    loadedValue: load ? value : fieldState.loadedValue\n  };\n\n  if ((0, _shallowEqual2.default)(field.value, value)) {\n    return _icepick2.default.merge(field, changedFieldProps);\n  }\n\n  if (removeKeys) {\n    (0, _invariant2.default)(field && field.$form, 'Unable to remove keys. ' + 'Field for \"%s\" in store is not an array/object.', model);\n\n    var valueIsArray = Array.isArray(field.$form.value);\n    var removeKeysArray = Array.isArray(removeKeys) ? removeKeys : [removeKeys];\n\n    var result = void 0;\n\n    if (valueIsArray) {\n      result = [];\n\n      Object.keys(field).forEach(function (key) {\n        if (!!~removeKeysArray.indexOf(+key) || key === '$form') return;\n\n        result[key] = _extends({}, field[key]);\n      });\n\n      var finalResult = _extends({}, result.filter(function (f) {\n        return f;\n      }).map(function (subField, index) {\n        return _extends({}, subField, {\n          model: model + '.' + index\n        });\n      }));\n\n      finalResult.$form = field.$form;\n\n      return finalResult;\n    }\n\n    result = _extends({}, field);\n\n    Object.keys(field).forEach(function (key) {\n      if (!!~removeKeysArray.indexOf(key)) {\n        delete result['' + key];\n      }\n    });\n\n    return result;\n  }\n\n  if (!Array.isArray(value) && !(0, _isPlainObject2.default)(value)) {\n    return _icepick2.default.merge(field, _icepick2.default.set(changedFieldProps, 'value', value));\n  }\n\n  var updatedField = (0, _mapValues2.default)(value, function (subValue, index) {\n    // TODO: refactor\n    var subField = field[index] || (0, _formReducer.createInitialState)('' + (parentModel ? parentModel + '.' : '') + model + '.' + index, subValue);\n\n    if (Object.hasOwnProperty.call(subField, '$form')) {\n      return updateFieldValue(subField, {\n        model: index,\n        value: subValue,\n        external: external,\n        silent: silent,\n        load: load\n      }, parentModel ? parentModel + '.' + model : model);\n    }\n\n    if ((0, _shallowEqual2.default)(subValue, subField.value)) {\n      return subField;\n    }\n\n    return _icepick2.default.merge(subField, _icepick2.default.assign(changedFieldProps, {\n      value: subValue,\n      loadedValue: load ? subValue : subField.loadedValue\n    }));\n  });\n\n  var dirtyFormState = _icepick2.default.merge(field.$form || _initialFieldState2.default, _icepick2.default.set(changedFieldProps, 'retouched', field.submitted || field.$form && field.$form.retouched));\n\n  return _icepick2.default.set(updatedField, '$form', dirtyFormState);\n}\n\nfunction changeActionReducer(state, action, localPath) {\n  if (action.type !== _actionTypes2.default.CHANGE) return state;\n\n  var field = (0, _get2.default)(state, localPath, (0, _formReducer.createInitialState)(action.model, action.value));\n\n  var updatedField = updateFieldValue(field, action);\n\n  if (!localPath.length) return updatedField;\n\n  var updatedState = (0, _assocIn2.default)(state, localPath, updatedField, function (form) {\n    if (!form.$form) return form;\n\n    var formValue = (0, _getFormValue2.default)(form);\n\n    var formUpdates = _extends({}, form.$form, {\n      value: formValue\n    });\n\n    if (action.silent) {\n      formUpdates.loadedValue = formValue;\n    } else {\n      formUpdates.pristine = false;\n    }\n\n    return _extends({}, form, {\n      $form: formUpdates\n    });\n  });\n\n  return updatedState;\n}"]},"metadata":{},"sourceType":"script"}