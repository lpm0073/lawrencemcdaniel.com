{"ast":null,"code":"import _classCallCheck from\"/Users/mcdaniel/github/lpm0073/lawrencemcdaniel.com/site/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/mcdaniel/github/lpm0073/lawrencemcdaniel.com/site/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/Users/mcdaniel/github/lpm0073/lawrencemcdaniel.com/site/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/Users/mcdaniel/github/lpm0073/lawrencemcdaniel.com/site/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/mcdaniel/github/lpm0073/lawrencemcdaniel.com/site/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import _objectSpread from\"/Users/mcdaniel/github/lpm0073/lawrencemcdaniel.com/site/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";/*\n    ----------------------------------------\n    How to store component state in Redux: https://medium.com/the-web-tub/managing-your-react-state-with-redux-affab72de4b1\n    ----------------------------------------\n\n    Renders a spinning cube that shows random collections of logos that randomly\n    update at random intervals. Logos are provided by a REST api that is \n    managed by Redux.\n    \n    Logos API: https://api.lawrencemcdaniel.com/wp-json/wp/v2/posts?categories=43&_embed&per_page=100\n\n    The cube, which is pure CSS and HTML, was scaffolded from a D3 example that I liked, created by Noah Veltman. \n    Ironically, the D3 source code itself wasn't useful. I encountered a variety of challenges with using D3.js for this component. \n    Though all of these challenges were solvable, in the end it was most practical to leave the DOM manipulations to ReactJS. \n    You can review the GitHub commit history of this file to see the early versions of this component implemented with D3.js\n\n    Noah's original cube: https://bl.ocks.org/veltman/4c989172ac2f820b0b7267c53cb96975 \n    \n\n    The component life cycle is as follows:\n    =================================================\n\n    1. Animated cube rendering (1000 ms):\n    This is intended to distract the site visitor for a moment while we pre-fetch the first set\n    of logo images (for slow internet connections).\n\n    2. Initial logo display (5000 ms):\n    Display six \"featured\" logos (one per cube side) that I most want visitors to see.\n    (React, Redux, Angular, Django, AWS, Wordpress)\n\n    3. Update infinitely:\n    Randomly show lots of other logos. The longer the site visitor stares at this logo cube\n    the better, because it buys time for the image pre-fetcher to download more \n    site content in the background. Don't be impressed however, I stole this idea from nytimes.com\n\n\n    Some of the challenges, and their solutions:\n    =================================================\n    A. Lack of impact\n    The logo cube is supposed to be a creative way of showcasing my most important\n    (self-proclaimed) technology skills to site visitors. Most visitors however,\n    will only see the cube for a couple of seconds and then move on to some other page.\n    Thus, a random selection of logos works at cross purposes to this design objective since \n    most of the logos pertain to lesser-known supporting technologies.\n\n    solution: I created a 2nd api feed consisting of six \"featured\" logos.\n    I initialize the cube with the featured logos, and then hold these\n    logos in place for 5 seconds before initiating the random logo replacements.\n    \n    B. Disappointing logo shuffle.\n    It bothered me that sometimes all six cube sides would display only\n    the logos of unimpressive technologies for an extended period of time.\n    I found myself staring at the cube anxiously waiting for a \"good\" \n    logo to appear.\n\n    solution: \n    I reserve one of the six cube sides for exclusively displaying\n    one of the six featured logos.\n\n    C. Reverse Rotation (aka \"Wagon Wheel\" Effect)\n    I had trouble visually tracking the motion of the original version of the cube's spinning animations.\n    The cube would sometimes appear to be spinning left-to-right, and other times right-to-left. In\n    the latter cases the cube appeared mal-constructed and disfigured. Here's a technical explanation\n    of the nature of this problem: https://en.wikipedia.org/wiki/Wagon-wheel_effect\n\n    solution:\n    First, i tinkered with the opacity of the cube sides so that the side that is supposed to be in front is brighter, \n    and the reverse side is darker. Secondly, adding the cube rendering helped a lot because the cube begins\n    as a 2-dimensional spinning square, which afterwards grows to become a cube. The 2D spinning image is easier for your\n    visual cortex to process, and the growth animation provides a way for your mind to bootstrap and retain what's\n    happening on-screen.\n\n    D. Screen flicker. \n    React mounts/unmounts components multiple times, often for \n    reasons that are external to the component. React also calls render()\n    several times during normal component initialization. Both of these are \n    problems for CSS animations because these end up getting killed in mid-animation and\n    restarted multiple times (ie screen flicker), which looks terrible.\n\n    solution: I fixed the screen flicker with a few different kinds of timers\n    that are intended to delay rendering the cube (and thus initiating the CSS\n    animations) until React has had enough time to get the home screen \n    completely setup.\n\n    E. Erratic Logo updates. \n    Logos change at random intervals. However, it looks bad if a logo is replaced too quickly. \n\n    solution: I added 6 timers to track the elapsed lifetime of each logo,\n    and then I only replace a logo if its been visible for a minimum\n    length of time.\n\n    F. Orphan Threads.\n    Launching the painter() method with a timer delay is tricky\n    because it is initiated on a new asynchronous background thread.\n    When the component mounts/unmounts very quickly, the threads lives on,\n    resulting in several painter() threads co-existing, which causes\n    the cube to update multitudes more frequently than I wanted.\n\n    solution: I fixed the threading issue by keeping track of, and explicitly killing \n    all background threads that I create.\n\n    G. Slow loading logos.\n    The cube itself is rendered purely in CSS and so always renders smoothly, but it\n    depends on a collection of around 75 logo images provided by the\n    REST api via Redux. On a slow internet connection you could see each new logo\n    downloading on the cube side, which looked terrible. \n\n    solution: i setup an image pre-fetcher inside of Redux, not just for\n    this logo cube but for the hundreds of other images on this site as\n    well.\n\n    H. Duplicate logos\n    It bothered me that the same logo would sometimes appears on two (or more)\n    sides.\n\n    solution: i added some \"no collision\" logic to prevent the random logo\n    selector from choosing any logos that are currently being displayed.\n\n*/import React,{Component}from'react';import{connect}from'react-redux';import{bindActionCreators}from'redux';import*as Actions from'../../redux/ActionCreators';import{shuffleArray}from'../../shared/shuffle';import'./styles.css';var mapStateToProps=function mapStateToProps(state){return _objectSpread({},state);};var mapDispatchToProps=function mapDispatchToProps(dispatch){return{actions:bindActionCreators(Actions,dispatch)};};var LogoCube=/*#__PURE__*/function(_Component){_inherits(LogoCube,_Component);var _super=_createSuper(LogoCube);function LogoCube(props){var _this;_classCallCheck(this,LogoCube);_this=_super.call(this,props);_this.getElapsedTime=_this.getElapsedTime.bind(_assertThisInitialized(_this));_this.getBackgroundUrl=_this.getBackgroundUrl.bind(_assertThisInitialized(_this));_this.setBackgroundUrl=_this.setBackgroundUrl.bind(_assertThisInitialized(_this));_this.getRandomSide=_this.getRandomSide.bind(_assertThisInitialized(_this));_this.getRandomLogo=_this.getRandomLogo.bind(_assertThisInitialized(_this));_this.getSerializedLogo=_this.getSerializedLogo.bind(_assertThisInitialized(_this));_this.isLogoCollision=_this.isLogoCollision.bind(_assertThisInitialized(_this));_this.repaint=_this.repaint.bind(_assertThisInitialized(_this));/* check for component state in Redux store */if(_this.props.logoCube.isSet){_this.state=_this.props.logoCube.state;}else{var d=new Date();var initialLogos=_this.getInitialCubeLogos();_this.state={/* delay threads, to prevent the component from re-rendering if we're in mid-animation */repaintDelay:null,/* the current logo image URL for each of the 6 logos */cubeTopBackgroundUrl:_this.getSerializedLogo(initialLogos,0),cubeBottomBackgroundUrl:_this.getSerializedLogo(initialLogos,1),cubeLeftBackgroundUrl:_this.getSerializedLogo(initialLogos,2),cubeRightBackgroundUrl:_this.getSerializedLogo(initialLogos,3),cubeFrontBackgroundUrl:_this.getSerializedLogo(initialLogos,4),cubeBackBackgroundUrl:_this.getSerializedLogo(initialLogos,5),/* time stamps to track elapsed time of each logo image */constructed:d,cubeTop:d,cubeBottom:d,cubeLeft:d,cubeRight:d,cubeFront:d,cubeBack:d};}return _this;}_createClass(LogoCube,[{key:\"componentDidMount\",value:function componentDidMount(){/* this is a general purpose moratorium on React\n        updates until the component actually mounts. From visual inspection in the \n        JS console this prevents the first dozen or\n        so calls to render(), which is what cause the\n        screen flicker. */var self=this;var myTimeout=setTimeout(function(){self.repaint();},100);this.setState({repaintDelay:myTimeout});}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){/* kill any pending background threads that were\n        invoked in componentDidMount(). */clearTimeout(this.state.repaintDelay);clearTimeout(this.state.fetchDelay);/* send component state to Redux store */var state=this.state;this.props.actions.setLogoState({state:state});}},{key:\"render\",value:function render(){var cls=!this.props.logoCube.isSet?\"grow-side\":\"\";return/*#__PURE__*/React.createElement(\"div\",{key:\"logo-cube\",className:\"d3-container mt-0\"},/*#__PURE__*/React.createElement(\"div\",{className:\"d3-cube mt-5\"},/*#__PURE__*/React.createElement(CubeSide,{side:\"top\",url:this.getBackgroundUrl(\"top\"),classes:\"fade-in\"}),/*#__PURE__*/React.createElement(CubeSide,{side:\"bottom\",url:this.getBackgroundUrl(\"bottom\"),classes:\"fade-in\"}),/*#__PURE__*/React.createElement(CubeSide,{side:\"front\",url:this.getBackgroundUrl(\"front\"),classes:cls}),/*#__PURE__*/React.createElement(CubeSide,{side:\"back\",url:this.getBackgroundUrl(\"back\"),classes:cls}),/*#__PURE__*/React.createElement(CubeSide,{side:\"right\",url:this.getBackgroundUrl(\"right\"),classes:cls}),/*#__PURE__*/React.createElement(CubeSide,{side:\"left\",url:this.getBackgroundUrl(\"left\"),classes:cls})));}},{key:\"repaint\",value:function repaint(){/* place a random logo on a random side at a random point in time. */if(!this.props.specialties.isLoading){var side=this.getRandomSide();var logos=side===\"front\"?this.props.specialties.featured_logos:this.props.specialties.logos;var logo=this.getRandomLogo(logos);var elapsed=this.getElapsedTime(side);if(side!=null&&elapsed>2000){this.setBackgroundUrl(side,logo);}}var self=this;setTimeout(function(){self.repaint();},500*Math.random());}/* ---------------------------------------------------------------\n        Hereon, the drudgerous grind of working with a six-sided object.  \n     * --------------------------------------------------------------- */},{key:\"getBackgroundUrl\",value:function getBackgroundUrl(side){var retval;switch(side){case\"top\":retval=this.state.cubeTopBackgroundUrl;break;case\"bottom\":retval=this.state.cubeBottomBackgroundUrl;break;case\"left\":retval=this.state.cubeLeftBackgroundUrl;break;case\"right\":retval=this.state.cubeRightBackgroundUrl;break;case\"front\":retval=this.state.cubeFrontBackgroundUrl;break;case\"back\":retval=this.state.cubeBackBackgroundUrl;break;default:retval=null;break;}return retval;}},{key:\"setBackgroundUrl\",value:function setBackgroundUrl(side,url){var d=new Date();var state;switch(side){case\"top\":state={cubeTopBackgroundUrl:url,cubeTop:d};break;case\"bottom\":state={cubeBottomBackgroundUrl:url,cubeBottom:d};break;case\"left\":state={cubeLeftBackgroundUrl:url,cubeLeft:d};break;case\"right\":state={cubeRightBackgroundUrl:url,cubeRight:d};break;case\"front\":state={cubeFrontBackgroundUrl:url,cubeFront:d};break;case\"back\":state={cubeBackBackgroundUrl:url,cubeBack:d};break;default:state={};break;}this.setState(state);}},{key:\"getElapsedTime\",value:function getElapsedTime(side){var d=new Date();switch(side){case\"top\":return d-this.state.cubeTop;case\"bottom\":return d-this.state.cubeBottom;case\"left\":return d-this.state.cubeLeft;case\"right\":return d-this.state.cubeRight;case\"front\":return d-this.state.cubeFront;case\"back\":return d-this.state.cubeBack;default:return d-this.state.constructed;}}},{key:\"getSerializedLogo\",value:function getSerializedLogo(logos,i){/* this handles the hopefully-rare case\n        where I might stupidly neglect to have 6 more\n        featured logos in the Wordpress api. */if(logos===null)return 0;if(i<logos.length){return logos[i];}}},{key:\"isLogoCollision\",value:function isLogoCollision(logo){switch(logo){case this.state.cubeTopBackgroundUrl:case this.state.cubeBottomBackgroundUrl:case this.state.cubeBackBackgroundUrl:case this.state.cubeFrontBackgroundUrl:case this.state.cubeLeftBackgroundUrl:case this.state.cubeRightBackgroundUrl:return true;default:return false;}}},{key:\"getRandomLogo\",value:function getRandomLogo(logos){if(logos===null)return null;var logo,i=0;do{logo=logos[Math.floor(Math.random()*logos.length)];i++;}while(this.isLogoCollision(logo)&&i<=logos.length);return logo;}},{key:\"getRandomSide\",value:function getRandomSide(){var side=Math.floor(Math.random()*6);switch(side){case 0:return\"top\";case 1:return\"bottom\";case 2:return\"left\";case 3:return\"right\";case 4:return\"front\";case 5:return\"back\";default:return null;}}},{key:\"getInitialCubeLogos\",value:function getInitialCubeLogos(){return shuffleArray(['assets/images/amazon-web-services.png','assets/images/django-logo-300x137.png','assets/images/open-edx.png','assets/images/react-logo-300x261.png','assets/images/Redux_Logo-300x80.png','assets/images/wordpress-100x161.png']);}}]);return LogoCube;}(Component);export default connect(mapStateToProps,mapDispatchToProps)(LogoCube);var CubeSide=function CubeSide(props){var clsId=\"d3-side \"+props.side+\" \"+props.classes;var divId=\"cube-\"+props.side+\"-logo-div\";var divStyle={backgroundImage:\"url('\"+props.url+\"')\"};return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{key:divId,className:clsId},/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"div\",{key:divId+\"-logo\",className:\"logo\",style:divStyle}))));};","map":{"version":3,"sources":["/Users/mcdaniel/github/lpm0073/lawrencemcdaniel.com/site/src/components/logoCube/Component.js"],"names":["React","Component","connect","bindActionCreators","Actions","shuffleArray","mapStateToProps","state","mapDispatchToProps","dispatch","actions","LogoCube","props","getElapsedTime","bind","getBackgroundUrl","setBackgroundUrl","getRandomSide","getRandomLogo","getSerializedLogo","isLogoCollision","repaint","logoCube","isSet","d","Date","initialLogos","getInitialCubeLogos","repaintDelay","cubeTopBackgroundUrl","cubeBottomBackgroundUrl","cubeLeftBackgroundUrl","cubeRightBackgroundUrl","cubeFrontBackgroundUrl","cubeBackBackgroundUrl","constructed","cubeTop","cubeBottom","cubeLeft","cubeRight","cubeFront","cubeBack","self","myTimeout","setTimeout","setState","clearTimeout","fetchDelay","setLogoState","cls","specialties","isLoading","side","logos","featured_logos","logo","elapsed","Math","random","retval","url","i","length","floor","CubeSide","clsId","classes","divId","divStyle","backgroundImage"],"mappings":"yhCAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EAuHA,MAAOA,CAAAA,KAAP,EAAgBC,SAAhB,KAAiC,OAAjC,CACA,OAASC,OAAT,KAAwB,aAAxB,CACA,OAASC,kBAAT,KAAmC,OAAnC,CACA,MAAO,GAAKC,CAAAA,OAAZ,KAAyB,4BAAzB,CAEA,OAASC,YAAT,KAA6B,sBAA7B,CACA,MAAO,cAAP,CAGA,GAAMC,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,CAAAC,KAAK,0BACpBA,KADoB,GAA7B,CAGA,GAAMC,CAAAA,kBAAkB,CAAG,QAArBA,CAAAA,kBAAqB,CAACC,QAAD,QAAe,CACtCC,OAAO,CAAEP,kBAAkB,CAACC,OAAD,CAAUK,QAAV,CADW,CAAf,EAA3B,C,GAIME,CAAAA,Q,oGAEF,kBAAYC,KAAZ,CAAmB,0CACf,uBAAMA,KAAN,EAEA,MAAKC,cAAL,CAAsB,MAAKA,cAAL,CAAoBC,IAApB,+BAAtB,CACA,MAAKC,gBAAL,CAAwB,MAAKA,gBAAL,CAAsBD,IAAtB,+BAAxB,CACA,MAAKE,gBAAL,CAAwB,MAAKA,gBAAL,CAAsBF,IAAtB,+BAAxB,CACA,MAAKG,aAAL,CAAqB,MAAKA,aAAL,CAAmBH,IAAnB,+BAArB,CACA,MAAKI,aAAL,CAAqB,MAAKA,aAAL,CAAmBJ,IAAnB,+BAArB,CACA,MAAKK,iBAAL,CAAyB,MAAKA,iBAAL,CAAuBL,IAAvB,+BAAzB,CACA,MAAKM,eAAL,CAAuB,MAAKA,eAAL,CAAqBN,IAArB,+BAAvB,CACA,MAAKO,OAAL,CAAe,MAAKA,OAAL,CAAaP,IAAb,+BAAf,CAEA,8CACA,GAAI,MAAKF,KAAL,CAAWU,QAAX,CAAoBC,KAAxB,CAA+B,CAC3B,MAAKhB,KAAL,CAAa,MAAKK,KAAL,CAAWU,QAAX,CAAoBf,KAAjC,CACH,CAFD,IAEO,CACH,GAAIiB,CAAAA,CAAC,CAAG,GAAIC,CAAAA,IAAJ,EAAR,CACA,GAAMC,CAAAA,YAAY,CAAG,MAAKC,mBAAL,EAArB,CAEA,MAAKpB,KAAL,CAAa,CAET,yFACAqB,YAAY,CAAE,IAHL,CAKT,wDACAC,oBAAoB,CAAE,MAAKV,iBAAL,CAAuBO,YAAvB,CAAqC,CAArC,CANb,CAOTI,uBAAuB,CAAE,MAAKX,iBAAL,CAAuBO,YAAvB,CAAqC,CAArC,CAPhB,CAQTK,qBAAqB,CAAE,MAAKZ,iBAAL,CAAuBO,YAAvB,CAAqC,CAArC,CARd,CASTM,sBAAsB,CAAE,MAAKb,iBAAL,CAAuBO,YAAvB,CAAqC,CAArC,CATf,CAUTO,sBAAsB,CAAE,MAAKd,iBAAL,CAAuBO,YAAvB,CAAqC,CAArC,CAVf,CAWTQ,qBAAqB,CAAE,MAAKf,iBAAL,CAAuBO,YAAvB,CAAqC,CAArC,CAXd,CAaT,0DACAS,WAAW,CAAEX,CAdJ,CAeTY,OAAO,CAAEZ,CAfA,CAgBTa,UAAU,CAAEb,CAhBH,CAiBTc,QAAQ,CAAEd,CAjBD,CAkBTe,SAAS,CAAEf,CAlBF,CAmBTgB,SAAS,CAAEhB,CAnBF,CAoBTiB,QAAQ,CAAEjB,CApBD,CAAb,CAwBH,CA3Cc,aA8ClB,C,kFAGmB,CAChB;;;;0BAMA,GAAMkB,CAAAA,IAAI,CAAG,IAAb,CACA,GAAIC,CAAAA,SAAS,CAAGC,UAAU,CAAC,UAAW,CAClCF,IAAI,CAACrB,OAAL,GACH,CAFyB,CAEvB,GAFuB,CAA1B,CAGA,KAAKwB,QAAL,CAAc,CACVjB,YAAY,CAAEe,SADJ,CAAd,EAIH,C,mEAEsB,CACnB;0CAEAG,YAAY,CAAC,KAAKvC,KAAL,CAAWqB,YAAZ,CAAZ,CACAkB,YAAY,CAAC,KAAKvC,KAAL,CAAWwC,UAAZ,CAAZ,CAEA,yCACA,GAAMxC,CAAAA,KAAK,CAAG,KAAKA,KAAnB,CACA,KAAKK,KAAL,CAAWF,OAAX,CAAmBsC,YAAnB,CAAgC,CAACzC,KAAK,CAALA,KAAD,CAAhC,EACH,C,uCAEQ,CACL,GAAM0C,CAAAA,GAAG,CAAG,CAAC,KAAKrC,KAAL,CAAWU,QAAX,CAAoBC,KAArB,CAA6B,WAA7B,CAA0C,EAAtD,CAEA,mBACI,2BAAK,GAAG,CAAC,WAAT,CAAqB,SAAS,CAAC,mBAA/B,eACI,2BAAK,SAAS,CAAC,cAAf,eACI,oBAAC,QAAD,EAAU,IAAI,CAAC,KAAf,CAAqB,GAAG,CAAE,KAAKR,gBAAL,CAAsB,KAAtB,CAA1B,CAAwD,OAAO,CAAC,SAAhE,EADJ,cAEI,oBAAC,QAAD,EAAU,IAAI,CAAC,QAAf,CAAwB,GAAG,CAAE,KAAKA,gBAAL,CAAsB,QAAtB,CAA7B,CAA8D,OAAO,CAAC,SAAtE,EAFJ,cAGI,oBAAC,QAAD,EAAU,IAAI,CAAC,OAAf,CAAuB,GAAG,CAAE,KAAKA,gBAAL,CAAsB,OAAtB,CAA5B,CAA4D,OAAO,CAAEkC,GAArE,EAHJ,cAII,oBAAC,QAAD,EAAU,IAAI,CAAC,MAAf,CAAsB,GAAG,CAAE,KAAKlC,gBAAL,CAAsB,MAAtB,CAA3B,CAA0D,OAAO,CAAEkC,GAAnE,EAJJ,cAKI,oBAAC,QAAD,EAAU,IAAI,CAAC,OAAf,CAAuB,GAAG,CAAE,KAAKlC,gBAAL,CAAsB,OAAtB,CAA5B,CAA4D,OAAO,CAAEkC,GAArE,EALJ,cAMI,oBAAC,QAAD,EAAU,IAAI,CAAC,MAAf,CAAsB,GAAG,CAAE,KAAKlC,gBAAL,CAAsB,MAAtB,CAA3B,CAA0D,OAAO,CAAEkC,GAAnE,EANJ,CADJ,CADJ,CAYH,C,yCAES,CACN,qEACA,GAAI,CAAC,KAAKrC,KAAL,CAAWsC,WAAX,CAAuBC,SAA5B,CAAuC,CAEnC,GAAMC,CAAAA,IAAI,CAAG,KAAKnC,aAAL,EAAb,CACA,GAAMoC,CAAAA,KAAK,CAAID,IAAI,GAAK,OAAV,CAAqB,KAAKxC,KAAL,CAAWsC,WAAX,CAAuBI,cAA5C,CAA4D,KAAK1C,KAAL,CAAWsC,WAAX,CAAuBG,KAAjG,CACA,GAAME,CAAAA,IAAI,CAAG,KAAKrC,aAAL,CAAmBmC,KAAnB,CAAb,CACA,GAAMG,CAAAA,OAAO,CAAG,KAAK3C,cAAL,CAAoBuC,IAApB,CAAhB,CACA,GAAIA,IAAI,EAAI,IAAR,EAAgBI,OAAO,CAAG,IAA9B,CAAoC,CAChC,KAAKxC,gBAAL,CAAsBoC,IAAtB,CAA4BG,IAA5B,EACH,CAEJ,CAED,GAAIb,CAAAA,IAAI,CAAG,IAAX,CACAE,UAAU,CAAC,UAAW,CAClBF,IAAI,CAACrB,OAAL,GACH,CAFS,CAEP,IAAMoC,IAAI,CAACC,MAAL,EAFC,CAAV,CAIH,CAED;;mIAGiBN,I,CAAM,CACnB,GAAIO,CAAAA,MAAJ,CACA,OAAOP,IAAP,EACI,IAAK,KAAL,CAAYO,MAAM,CAAG,KAAKpD,KAAL,CAAWsB,oBAApB,CAA0C,MACtD,IAAK,QAAL,CAAe8B,MAAM,CAAI,KAAKpD,KAAL,CAAWuB,uBAArB,CAA8C,MAC7D,IAAK,MAAL,CAAa6B,MAAM,CAAI,KAAKpD,KAAL,CAAWwB,qBAArB,CAA4C,MACzD,IAAK,OAAL,CAAc4B,MAAM,CAAI,KAAKpD,KAAL,CAAWyB,sBAArB,CAA6C,MAC3D,IAAK,OAAL,CAAc2B,MAAM,CAAI,KAAKpD,KAAL,CAAW0B,sBAArB,CAA6C,MAC3D,IAAK,MAAL,CAAa0B,MAAM,CAAI,KAAKpD,KAAL,CAAW2B,qBAArB,CAA4C,MACzD,QAASyB,MAAM,CAAG,IAAT,CAAe,MAP5B,CASA,MAAOA,CAAAA,MAAP,CACH,C,0DAEgBP,I,CAAMQ,G,CAAK,CACxB,GAAMpC,CAAAA,CAAC,CAAG,GAAIC,CAAAA,IAAJ,EAAV,CAEA,GAAIlB,CAAAA,KAAJ,CACA,OAAO6C,IAAP,EACI,IAAK,KAAL,CAAY7C,KAAK,CAAG,CAACsB,oBAAoB,CAAE+B,GAAvB,CAA4BxB,OAAO,CAAEZ,CAArC,CAAR,CAAiD,MAC7D,IAAK,QAAL,CAAejB,KAAK,CAAG,CAACuB,uBAAuB,CAAE8B,GAA1B,CAA+BvB,UAAU,CAAEb,CAA3C,CAAR,CAAuD,MACtE,IAAK,MAAL,CAAajB,KAAK,CAAG,CAACwB,qBAAqB,CAAE6B,GAAxB,CAA6BtB,QAAQ,CAAEd,CAAvC,CAAR,CAAmD,MAChE,IAAK,OAAL,CAAcjB,KAAK,CAAG,CAACyB,sBAAsB,CAAE4B,GAAzB,CAA8BrB,SAAS,CAAEf,CAAzC,CAAR,CAAqD,MACnE,IAAK,OAAL,CAAcjB,KAAK,CAAG,CAAC0B,sBAAsB,CAAE2B,GAAzB,CAA8BpB,SAAS,CAAEhB,CAAzC,CAAR,CAAqD,MACnE,IAAK,MAAL,CAAajB,KAAK,CAAG,CAAC2B,qBAAqB,CAAE0B,GAAxB,CAA6BnB,QAAQ,CAAEjB,CAAvC,CAAR,CAAmD,MAChE,QAASjB,KAAK,CAAG,EAAR,CAAY,MAPzB,CASA,KAAKsC,QAAL,CAActC,KAAd,EACH,C,sDAGc6C,I,CAAM,CACjB,GAAM5B,CAAAA,CAAC,CAAG,GAAIC,CAAAA,IAAJ,EAAV,CACA,OAAO2B,IAAP,EACI,IAAK,KAAL,CAAY,MAAO5B,CAAAA,CAAC,CAAG,KAAKjB,KAAL,CAAW6B,OAAtB,CACZ,IAAK,QAAL,CAAe,MAAOZ,CAAAA,CAAC,CAAG,KAAKjB,KAAL,CAAW8B,UAAtB,CACf,IAAK,MAAL,CAAa,MAAOb,CAAAA,CAAC,CAAG,KAAKjB,KAAL,CAAW+B,QAAtB,CACb,IAAK,OAAL,CAAc,MAAOd,CAAAA,CAAC,CAAG,KAAKjB,KAAL,CAAWgC,SAAtB,CACd,IAAK,OAAL,CAAc,MAAOf,CAAAA,CAAC,CAAG,KAAKjB,KAAL,CAAWiC,SAAtB,CACd,IAAK,MAAL,CAAa,MAAOhB,CAAAA,CAAC,CAAG,KAAKjB,KAAL,CAAWkC,QAAtB,CACb,QAAS,MAAOjB,CAAAA,CAAC,CAAG,KAAKjB,KAAL,CAAW4B,WAAtB,CAPb,CASH,C,4DAEiBkB,K,CAAOQ,C,CAAG,CACxB;;+CAIA,GAAIR,KAAK,GAAK,IAAd,CAAoB,MAAO,EAAP,CAEpB,GAAIQ,CAAC,CAAGR,KAAK,CAACS,MAAd,CAAsB,CAClB,MAAOT,CAAAA,KAAK,CAACQ,CAAD,CAAZ,CACH,CACJ,C,wDACeN,I,CAAM,CAElB,OAAQA,IAAR,EACI,IAAK,MAAKhD,KAAL,CAAWsB,oBAAhB,CACA,IAAK,MAAKtB,KAAL,CAAWuB,uBAAhB,CACA,IAAK,MAAKvB,KAAL,CAAW2B,qBAAhB,CACA,IAAK,MAAK3B,KAAL,CAAW0B,sBAAhB,CACA,IAAK,MAAK1B,KAAL,CAAWwB,qBAAhB,CACA,IAAK,MAAKxB,KAAL,CAAWyB,sBAAhB,CACI,MAAO,KAAP,CACJ,QACI,MAAO,MAAP,CATR,CAYH,C,oDAEaqB,K,CAAO,CACjB,GAAIA,KAAK,GAAK,IAAd,CAAoB,MAAO,KAAP,CAEpB,GAAIE,CAAAA,IAAJ,CAAUM,CAAC,CAAG,CAAd,CACA,EAAG,CACCN,IAAI,CAAGF,KAAK,CAACI,IAAI,CAACM,KAAL,CAAWN,IAAI,CAACC,MAAL,GAAgBL,KAAK,CAACS,MAAjC,CAAD,CAAZ,CACAD,CAAC,GACJ,CAHD,MAGS,KAAKzC,eAAL,CAAqBmC,IAArB,GAA+BM,CAAC,EAAIR,KAAK,CAACS,MAHnD,EAIA,MAAOP,CAAAA,IAAP,CACH,C,qDAGe,CAEZ,GAAMH,CAAAA,IAAI,CAAGK,IAAI,CAACM,KAAL,CAAWN,IAAI,CAACC,MAAL,GAAgB,CAA3B,CAAb,CACA,OAAON,IAAP,EACI,IAAK,EAAL,CAAQ,MAAO,KAAP,CACR,IAAK,EAAL,CAAQ,MAAO,QAAP,CACR,IAAK,EAAL,CAAQ,MAAO,MAAP,CACR,IAAK,EAAL,CAAQ,MAAO,OAAP,CACR,IAAK,EAAL,CAAQ,MAAO,OAAP,CACR,IAAK,EAAL,CAAQ,MAAO,MAAP,CACR,QAAS,MAAO,KAAP,CAPb,CAUH,C,iEAEqB,CAClB,MAAO/C,CAAAA,YAAY,CAAC,CAChB,uCADgB,CAEhB,uCAFgB,CAGhB,4BAHgB,CAIhB,sCAJgB,CAKhB,qCALgB,CAMhB,qCANgB,CAAD,CAAnB,CAQH,C,sBAnOkBJ,S,EAwOvB,cAAeC,CAAAA,OAAO,CAACI,eAAD,CAAkBE,kBAAlB,CAAP,CAA6CG,QAA7C,CAAf,CAEA,GAAMqD,CAAAA,QAAQ,CAAG,QAAXA,CAAAA,QAAW,CAACpD,KAAD,CAAW,CAExB,GAAMqD,CAAAA,KAAK,CAAG,WAAarD,KAAK,CAACwC,IAAnB,CAA0B,GAA1B,CAAgCxC,KAAK,CAACsD,OAApD,CACA,GAAMC,CAAAA,KAAK,CAAG,QAAUvD,KAAK,CAACwC,IAAhB,CAAuB,WAArC,CACA,GAAMgB,CAAAA,QAAQ,CAAG,CACbC,eAAe,CAAE,QAAUzD,KAAK,CAACgD,GAAhB,CAAsB,IAD1B,CAAjB,CAIA,mBACI,oBAAC,KAAD,CAAO,QAAP,mBACI,2BAAK,GAAG,CAAEO,KAAV,CACK,SAAS,CAAEF,KADhB,eAEI,4CACI,2BAAK,GAAG,CAAEE,KAAK,CAAC,OAAhB,CAAyB,SAAS,CAAC,MAAnC,CACI,KAAK,CAAEC,QADX,EADJ,CAFJ,CADJ,CADJ,CAYH,CApBD","sourcesContent":["/*\n    ----------------------------------------\n    How to store component state in Redux: https://medium.com/the-web-tub/managing-your-react-state-with-redux-affab72de4b1\n    ----------------------------------------\n\n    Renders a spinning cube that shows random collections of logos that randomly\n    update at random intervals. Logos are provided by a REST api that is \n    managed by Redux.\n    \n    Logos API: https://api.lawrencemcdaniel.com/wp-json/wp/v2/posts?categories=43&_embed&per_page=100\n\n    The cube, which is pure CSS and HTML, was scaffolded from a D3 example that I liked, created by Noah Veltman. \n    Ironically, the D3 source code itself wasn't useful. I encountered a variety of challenges with using D3.js for this component. \n    Though all of these challenges were solvable, in the end it was most practical to leave the DOM manipulations to ReactJS. \n    You can review the GitHub commit history of this file to see the early versions of this component implemented with D3.js\n\n    Noah's original cube: https://bl.ocks.org/veltman/4c989172ac2f820b0b7267c53cb96975 \n    \n\n    The component life cycle is as follows:\n    =================================================\n\n    1. Animated cube rendering (1000 ms):\n    This is intended to distract the site visitor for a moment while we pre-fetch the first set\n    of logo images (for slow internet connections).\n\n    2. Initial logo display (5000 ms):\n    Display six \"featured\" logos (one per cube side) that I most want visitors to see.\n    (React, Redux, Angular, Django, AWS, Wordpress)\n\n    3. Update infinitely:\n    Randomly show lots of other logos. The longer the site visitor stares at this logo cube\n    the better, because it buys time for the image pre-fetcher to download more \n    site content in the background. Don't be impressed however, I stole this idea from nytimes.com\n\n\n    Some of the challenges, and their solutions:\n    =================================================\n    A. Lack of impact\n    The logo cube is supposed to be a creative way of showcasing my most important\n    (self-proclaimed) technology skills to site visitors. Most visitors however,\n    will only see the cube for a couple of seconds and then move on to some other page.\n    Thus, a random selection of logos works at cross purposes to this design objective since \n    most of the logos pertain to lesser-known supporting technologies.\n\n    solution: I created a 2nd api feed consisting of six \"featured\" logos.\n    I initialize the cube with the featured logos, and then hold these\n    logos in place for 5 seconds before initiating the random logo replacements.\n    \n    B. Disappointing logo shuffle.\n    It bothered me that sometimes all six cube sides would display only\n    the logos of unimpressive technologies for an extended period of time.\n    I found myself staring at the cube anxiously waiting for a \"good\" \n    logo to appear.\n\n    solution: \n    I reserve one of the six cube sides for exclusively displaying\n    one of the six featured logos.\n\n    C. Reverse Rotation (aka \"Wagon Wheel\" Effect)\n    I had trouble visually tracking the motion of the original version of the cube's spinning animations.\n    The cube would sometimes appear to be spinning left-to-right, and other times right-to-left. In\n    the latter cases the cube appeared mal-constructed and disfigured. Here's a technical explanation\n    of the nature of this problem: https://en.wikipedia.org/wiki/Wagon-wheel_effect\n\n    solution:\n    First, i tinkered with the opacity of the cube sides so that the side that is supposed to be in front is brighter, \n    and the reverse side is darker. Secondly, adding the cube rendering helped a lot because the cube begins\n    as a 2-dimensional spinning square, which afterwards grows to become a cube. The 2D spinning image is easier for your\n    visual cortex to process, and the growth animation provides a way for your mind to bootstrap and retain what's\n    happening on-screen.\n\n    D. Screen flicker. \n    React mounts/unmounts components multiple times, often for \n    reasons that are external to the component. React also calls render()\n    several times during normal component initialization. Both of these are \n    problems for CSS animations because these end up getting killed in mid-animation and\n    restarted multiple times (ie screen flicker), which looks terrible.\n\n    solution: I fixed the screen flicker with a few different kinds of timers\n    that are intended to delay rendering the cube (and thus initiating the CSS\n    animations) until React has had enough time to get the home screen \n    completely setup.\n\n    E. Erratic Logo updates. \n    Logos change at random intervals. However, it looks bad if a logo is replaced too quickly. \n\n    solution: I added 6 timers to track the elapsed lifetime of each logo,\n    and then I only replace a logo if its been visible for a minimum\n    length of time.\n\n    F. Orphan Threads.\n    Launching the painter() method with a timer delay is tricky\n    because it is initiated on a new asynchronous background thread.\n    When the component mounts/unmounts very quickly, the threads lives on,\n    resulting in several painter() threads co-existing, which causes\n    the cube to update multitudes more frequently than I wanted.\n\n    solution: I fixed the threading issue by keeping track of, and explicitly killing \n    all background threads that I create.\n\n    G. Slow loading logos.\n    The cube itself is rendered purely in CSS and so always renders smoothly, but it\n    depends on a collection of around 75 logo images provided by the\n    REST api via Redux. On a slow internet connection you could see each new logo\n    downloading on the cube side, which looked terrible. \n\n    solution: i setup an image pre-fetcher inside of Redux, not just for\n    this logo cube but for the hundreds of other images on this site as\n    well.\n\n    H. Duplicate logos\n    It bothered me that the same logo would sometimes appears on two (or more)\n    sides.\n\n    solution: i added some \"no collision\" logic to prevent the random logo\n    selector from choosing any logos that are currently being displayed.\n\n*/\nimport React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport { bindActionCreators } from 'redux';\nimport * as Actions from '../../redux/ActionCreators';\n\nimport { shuffleArray } from '../../shared/shuffle';\nimport './styles.css';\n\n\nconst mapStateToProps = state => ({\n      ...state\n});\nconst mapDispatchToProps = (dispatch) => ({\n    actions: bindActionCreators(Actions, dispatch)\n});\n  \nclass LogoCube extends Component {\n\n    constructor(props) {\n        super(props);\n\n        this.getElapsedTime = this.getElapsedTime.bind(this);\n        this.getBackgroundUrl = this.getBackgroundUrl.bind(this);\n        this.setBackgroundUrl = this.setBackgroundUrl.bind(this);\n        this.getRandomSide = this.getRandomSide.bind(this);\n        this.getRandomLogo = this.getRandomLogo.bind(this);\n        this.getSerializedLogo = this.getSerializedLogo.bind(this);\n        this.isLogoCollision = this.isLogoCollision.bind(this);\n        this.repaint = this.repaint.bind(this);\n\n        /* check for component state in Redux store */\n        if (this.props.logoCube.isSet) {\n            this.state = this.props.logoCube.state;\n        } else {\n            var d = new Date();\n            const initialLogos = this.getInitialCubeLogos();\n    \n            this.state = {\n\n                /* delay threads, to prevent the component from re-rendering if we're in mid-animation */\n                repaintDelay: null,\n    \n                /* the current logo image URL for each of the 6 logos */\n                cubeTopBackgroundUrl: this.getSerializedLogo(initialLogos, 0),\n                cubeBottomBackgroundUrl: this.getSerializedLogo(initialLogos, 1),\n                cubeLeftBackgroundUrl: this.getSerializedLogo(initialLogos, 2),\n                cubeRightBackgroundUrl: this.getSerializedLogo(initialLogos, 3),\n                cubeFrontBackgroundUrl: this.getSerializedLogo(initialLogos, 4),\n                cubeBackBackgroundUrl: this.getSerializedLogo(initialLogos, 5),\n    \n                /* time stamps to track elapsed time of each logo image */\n                constructed: d,\n                cubeTop: d,\n                cubeBottom: d,\n                cubeLeft: d,\n                cubeRight: d,\n                cubeFront: d,\n                cubeBack: d\n    \n              };\n    \n        }\n\n\n    }\n\n\n    componentDidMount() {\n        /* this is a general purpose moratorium on React\n        updates until the component actually mounts. From visual inspection in the \n        JS console this prevents the first dozen or\n        so calls to render(), which is what cause the\n        screen flicker. */\n\n        const self = this;\n        var myTimeout = setTimeout(function() {\n            self.repaint();\n        }, 100);    \n        this.setState({\n            repaintDelay: myTimeout\n        });\n\n    }\n\n    componentWillUnmount() {\n        /* kill any pending background threads that were\n        invoked in componentDidMount(). */\n        clearTimeout(this.state.repaintDelay);\n        clearTimeout(this.state.fetchDelay);\n\n        /* send component state to Redux store */\n        const state = this.state;\n        this.props.actions.setLogoState({state});\n    }\n    \n    render() {\n        const cls = !this.props.logoCube.isSet ? \"grow-side\": \"\" ;\n\n        return(\n            <div key=\"logo-cube\" className=\"d3-container mt-0\">\n                <div className=\"d3-cube mt-5\">\n                    <CubeSide side=\"top\" url={this.getBackgroundUrl(\"top\")} classes=\"fade-in\" />\n                    <CubeSide side=\"bottom\" url={this.getBackgroundUrl(\"bottom\")} classes=\"fade-in\" />\n                    <CubeSide side=\"front\" url={this.getBackgroundUrl(\"front\")} classes={cls} />\n                    <CubeSide side=\"back\" url={this.getBackgroundUrl(\"back\")} classes={cls} />\n                    <CubeSide side=\"right\" url={this.getBackgroundUrl(\"right\")} classes={cls} />\n                    <CubeSide side=\"left\" url={this.getBackgroundUrl(\"left\")} classes={cls} />\n                </div>\n            </div>\n        );\n    }\n\n    repaint() {\n        /* place a random logo on a random side at a random point in time. */\n        if (!this.props.specialties.isLoading) {\n\n            const side = this.getRandomSide();\n            const logos = (side === \"front\") ? this.props.specialties.featured_logos: this.props.specialties.logos;\n            const logo = this.getRandomLogo(logos);\n            const elapsed = this.getElapsedTime(side);\n            if (side != null && elapsed > 2000) {\n                this.setBackgroundUrl(side, logo);\n            }\n\n        }\n    \n        var self = this;\n        setTimeout(function() {\n            self.repaint();\n        }, 500 * Math.random());   \n      \n    }\n\n    /* ---------------------------------------------------------------\n        Hereon, the drudgerous grind of working with a six-sided object.  \n     * --------------------------------------------------------------- */\n    getBackgroundUrl(side) {\n        let retval;\n        switch(side) {\n            case \"top\": retval = this.state.cubeTopBackgroundUrl; break;\n            case \"bottom\": retval =  this.state.cubeBottomBackgroundUrl; break;\n            case \"left\": retval =  this.state.cubeLeftBackgroundUrl; break;\n            case \"right\": retval =  this.state.cubeRightBackgroundUrl; break;\n            case \"front\": retval =  this.state.cubeFrontBackgroundUrl; break;\n            case \"back\": retval =  this.state.cubeBackBackgroundUrl; break;\n            default: retval = null; break;\n        }\n        return retval;\n    }\n\n    setBackgroundUrl(side, url) {\n        const d = new Date();\n\n        let state;\n        switch(side) {\n            case \"top\": state = {cubeTopBackgroundUrl: url, cubeTop: d}; break;\n            case \"bottom\": state = {cubeBottomBackgroundUrl: url, cubeBottom: d}; break;\n            case \"left\": state = {cubeLeftBackgroundUrl: url, cubeLeft: d}; break;\n            case \"right\": state = {cubeRightBackgroundUrl: url, cubeRight: d}; break;\n            case \"front\": state = {cubeFrontBackgroundUrl: url, cubeFront: d}; break;\n            case \"back\": state = {cubeBackBackgroundUrl: url, cubeBack: d}; break;\n            default: state = {}; break;\n        }\n        this.setState(state);\n    }\n\n\n    getElapsedTime(side) {\n        const d = new Date();\n        switch(side) {\n            case \"top\": return d - this.state.cubeTop;\n            case \"bottom\": return d - this.state.cubeBottom;\n            case \"left\": return d - this.state.cubeLeft;\n            case \"right\": return d - this.state.cubeRight;\n            case \"front\": return d - this.state.cubeFront;\n            case \"back\": return d - this.state.cubeBack;\n            default: return d - this.state.constructed;\n        }\n    }\n      \n    getSerializedLogo(logos, i) {\n        /* this handles the hopefully-rare case\n        where I might stupidly neglect to have 6 more\n        featured logos in the Wordpress api. */\n\n        if (logos === null) return 0;\n\n        if (i < logos.length) {\n            return logos[i];\n        }\n    }\n    isLogoCollision(logo) {\n\n        switch (logo) {\n            case this.state.cubeTopBackgroundUrl:\n            case this.state.cubeBottomBackgroundUrl:\n            case this.state.cubeBackBackgroundUrl:\n            case this.state.cubeFrontBackgroundUrl:\n            case this.state.cubeLeftBackgroundUrl:\n            case this.state.cubeRightBackgroundUrl:\n                return true;\n            default:\n                return false;\n        }\n\n    }\n\n    getRandomLogo(logos) {\n        if (logos === null) return null;\n\n        var logo, i = 0;\n        do {\n            logo = logos[Math.floor(Math.random() * logos.length)];\n            i++;\n        } while (this.isLogoCollision(logo) && (i <= logos.length))\n        return logo;\n    }\n\n    \n    getRandomSide() {\n\n        const side = Math.floor(Math.random() * 6);\n        switch(side) {\n            case 0: return \"top\";\n            case 1: return \"bottom\";\n            case 2: return \"left\";\n            case 3: return \"right\";\n            case 4: return \"front\";\n            case 5: return \"back\";\n            default: return null;\n        }\n    \n    }\n\n    getInitialCubeLogos() {\n        return shuffleArray([\n            'assets/images/amazon-web-services.png',\n            'assets/images/django-logo-300x137.png',\n            'assets/images/open-edx.png',\n            'assets/images/react-logo-300x261.png',\n            'assets/images/Redux_Logo-300x80.png',\n            'assets/images/wordpress-100x161.png'\n        ]);\n    }\n\n   \n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(LogoCube);\n\nconst CubeSide = (props) => {\n\n    const clsId = \"d3-side \" + props.side + \" \" + props.classes;\n    const divId = \"cube-\" + props.side + \"-logo-div\";\n    const divStyle = {\n        backgroundImage: \"url('\" + props.url + \"')\"\n      }\n\n    return(\n        <React.Fragment >\n            <div key={divId}\n                 className={clsId}>\n                <div>\n                    <div key={divId+\"-logo\"} className=\"logo\" \n                        style={divStyle}>\n                    </div>\n                </div>\n            </div>\n        </React.Fragment>\n    );\n}"]},"metadata":{},"sourceType":"module"}