{"ast":null,"code":"var _jsxFileName = \"/Users/mcdaniel/github/lpm0073/lawrencemcdaniel.com/site/src/components/logoCube/Component.js\";\n\n/*\n    Renders a spinning cube that shows random collections of logos that randomly\n    update at random intervals. Logos are provided by a REST api that is \n    managed by Redux.\n    \n    Logos API: https://api.lawrencemcdaniel.com/wp-json/wp/v2/posts?categories=43&_embed&per_page=100\n\n    The cube, which is pure CSS and HTML, was scaffolded from a D3 example that I liked, created by Noah Veltman. \n    Ironically, the D3 source code itself wasn't useful. I encountered a variety of challenges with using D3.js for this component. \n    Though all of these challenges were solvable, in the end it was most practical to leave the DOM manipulations to ReactJS. \n    You can review the GitHub commit history of this file to see the early versions of this component implemented with D3.js\n\n    Noah's original cube: https://bl.ocks.org/veltman/4c989172ac2f820b0b7267c53cb96975 \n    \n\n    The component life cycle is as follows:\n    =================================================\n\n    1. Animated cube rendering (1000 ms):\n    This is intended to distract the site visitor for a moment while we pre-fetch the first set\n    of logo images (for slow internet connections).\n\n    2. Initial logo display (5000 ms):\n    Display six \"featured\" logos (one per cube side) that I most want visitors to see.\n    (React, Redux, Angular, Django, AWS, Wordpress)\n\n    3. Update infinitely:\n    Randomly show lots of other logos. The longer the site visitor stares at this logo cube\n    the better, because it buys time for the image pre-fetcher to download more \n    site content in the background. Don't be impressed however, I stole this idea from nytimes.com\n\n\n    Some of the challenges, and their solutions:\n    =================================================\n    A. Lack of impact\n    The logo cube is supposed to be a creative way of showcasing my most important\n    (self-proclaimed) technology skills to site visitors. Most visitors however,\n    will only see the cube for a couple of seconds and then move on to some other page.\n    Thus, a random selection of logos works at cross purposes to this design objective since \n    most of the logos pertain to lesser-known supporting technologies.\n\n    solution: I created a 2nd api feed consisting of six \"featured\" logos.\n    I initialize the cube with the featured logos, and then hold these\n    logos in place for 5 seconds before initiating the random logo replacements.\n    \n    B. Disappointing logo shuffle.\n    It bothered me that sometimes all six cube sides would display only\n    the logos of unimpressive technologies for an extended period of time.\n    I found myself staring at the cube anxiously waiting for a \"good\" \n    logo to appear.\n\n    solution: \n    I reserve one of the six cube sides for exclusively displaying\n    one of the six featured logos.\n\n    C. Reverse Rotation (aka \"Wagon Wheel\" Effect)\n    I had trouble visually tracking the motion of the original version of the cube's spinning animations.\n    The cube would sometimes appear to be spinning left-to-right, and other times right-to-left. In\n    the latter cases the cube appeared mal-constructed and disfigured. Here's a technical explanation\n    of the nature of this problem: https://en.wikipedia.org/wiki/Wagon-wheel_effect\n\n    solution:\n    First, i tinkered with the opacity of the cube sides so that the side that is supposed to be in front is brighter, \n    and the reverse side is darker. Secondly, adding the cube rendering helped a lot because the cube begins\n    as a 2-dimensional spinning square, which afterwards grows to become a cube. The 2D spinning image is easier for your\n    visual cortex to process, and the growth animation provides a way for your mind to bootstrap and retain what's\n    happening on-screen.\n\n    D. Screen flicker. \n    React mounts/unmounts components multiple times, often for \n    reasons that are external to the component. React also calls render()\n    several times during normal component initialization. Both of these are \n    problems for CSS animations because these end up getting killed in mid-animation and\n    restarted multiple times (ie screen flicker), which looks terrible.\n\n    solution: I fixed the screen flicker with a few different kinds of timers\n    that are intended to delay rendering the cube (and thus initiating the CSS\n    animations) until React has had enough time to get the home screen \n    completely setup.\n\n    E. Erratic Logo updates. \n    Logos change at random intervals. However, it looks bad if a logo is replaced too quickly. \n\n    solution: I added 6 timers to track the elapsed lifetime of each logo,\n    and then I only replace a logo if its been visible for a minimum\n    length of time.\n\n    F. Orphan Threads.\n    Launching the painter() method with a timer delay is tricky\n    because it is initiated on a new asynchronous background thread.\n    When the component mounts/unmounts very quickly, the threads lives on,\n    resulting in several painter() threads co-existing, which causes\n    the cube to update multitudes more frequently than I wanted.\n\n    solution: I fixed the threading issue by keeping track of, and explicitly killing \n    all background threads that I create.\n\n    G. Slow loading logos.\n    The cube itself is rendered purely in CSS and so always renders smoothly, but it\n    depends on a collection of around 75 logo images provided by the\n    REST api via Redux. On a slow internet connection you could see each new logo\n    downloading on the cube side, which looked terrible. \n\n    solution: i setup an image pre-fetcher inside of Redux, not just for\n    this logo cube but for the hundreds of other images on this site as\n    well.\n\n    H. Duplicate logos\n    It bothered me that the same logo would sometimes appears on two (or more)\n    sides.\n\n    solution: i added some \"no collision\" logic to prevent the random logo\n    selector from choosing any logos that are currently being displayed.\n\n*/\nimport React, { Component } from 'react';\nimport { wpGetFeaturedImage } from '../../shared/wpGetFeaturedImage';\nimport './styles.css';\nimport Loading from '../Loading';\n\nclass LogoCube extends Component {\n  constructor(props) {\n    super(props);\n    var d = new Date();\n    /* Logo urls from Redux */\n\n    const logos = this.props.logos.items.map((post, indx) => {\n      /* \n      image list is managed by a Wordpress api and a custom\n      plugin that a) web-optimizes images b) uploads images to\n      the CDN, and c) creates a collection of alternative \n      image sizes. The rest api therefore returns\n      many possible URL's for each URL. wpGetFeaturedImage()\n      sifts through the list to choose the best image for our\n      particular need.\n       */\n      return wpGetFeaturedImage(post, null);\n    });\n    /* I flagged six images in Wordpress that I want displayed\n    when the cube first renders. */\n\n    const featured_logos = this.props.logos.items.filter((post, indx) => {\n      for (var i = 0; i < post.categories.length; i++) {\n        if (post.categories[i] === 48) {\n          /* featured technology */\n          return true;\n        }\n      }\n\n      return false;\n    }).map((featuredPost, indx) => {\n      return wpGetFeaturedImage(featuredPost, null);\n    });\n    this.state = {\n      /* logo lists */\n      logos: logos,\n      featured_logos: featured_logos,\n\n      /* the current logo image URL for each of the 6 logos */\n      cubeTopBackgroundUrl: null,\n      cubeBottomBackgroundUrl: null,\n      cubeLeftBackgroundUrl: null,\n      cubeRightBackgroundUrl: null,\n      cubeFrontBackgroundUrl: null,\n      cubeBackBackgroundUrl: null,\n\n      /* delay threads, to prevent the component from re-rendering if we're in mid-animation */\n      repaintDelay: null,\n      logosDelay: null,\n      shouldRender: false,\n\n      /* allow updates while the \"Loading\" spinner is present */\n\n      /* time stamps to track elapsed time of each logo image */\n      constructed: d,\n      cubeTop: d,\n      cubeBottom: d,\n      cubeLeft: d,\n      cubeRight: d,\n      cubeFront: d,\n      cubeBack: d\n    };\n    this.resetElapsedTime = this.resetElapsedTime.bind(this);\n    this.getElapsedTime = this.getElapsedTime.bind(this);\n    this.getBackgroundUrl = this.getBackgroundUrl.bind(this);\n    this.setBackgroundUrl = this.setBackgroundUrl.bind(this);\n    this.getRandomSide = this.getRandomSide.bind(this);\n    this.getRandomLogo = this.getRandomLogo.bind(this);\n    this.getSerializedLogo = this.getSerializedLogo.bind(this);\n    this.isLogoCollision = this.isLogoCollision.bind(this);\n    this.repaint = this.repaint.bind(this);\n  }\n\n  componentDidMount() {\n    var self = this;\n    /* this is a general purpose moratorium on React\n    updates for the first 50ms of the component's\n    life cycle. From visual inspection in the \n    JS console this prevents the first dozen or\n    so calls to render(), which is what cause the\n    screen flicker. */\n\n    var myTimeout = setTimeout(function () {\n      if (!self.state.shouldRender) {\n        self.setState({\n          shouldRender: true\n        });\n      }\n    }, 50);\n    /*\n        Note: componentDidMount() gets called a half dozen times bc the Home component\n        which instantiates this component itself mounts and unmounts multiple times.\n         we therefore delay the first repaint for a while. however\n        we also have to keep track of the repaint() threads that we invoke so that \n        we can kill them in cases where the component mounts and then quickly unmounts.\n     */\n\n    if (!this.props.logos.isLoading) {\n      /* This is intended to create a small dramatic delay between the initial\n      cube-rendering animation and the presentation of the first set of logos. */\n      myTimeout = setTimeout(function () {\n        self.setBackgroundUrl(\"left\", self.getSerializedLogo(self.state.featured_logos, 0));\n        self.setBackgroundUrl(\"right\", self.getSerializedLogo(self.state.featured_logos, 1));\n        self.setBackgroundUrl(\"top\", self.getSerializedLogo(self.state.featured_logos, 2));\n        self.setBackgroundUrl(\"bottom\", self.getSerializedLogo(self.state.featured_logos, 3));\n        self.setBackgroundUrl(\"front\", self.getSerializedLogo(self.state.featured_logos, 4));\n        self.setBackgroundUrl(\"back\", self.getSerializedLogo(self.state.featured_logos, 5));\n      }, 500);\n      self.setState({\n        logosDelay: myTimeout\n      });\n      /* Begin random logo updates after a 5-second initial delay */\n\n      myTimeout = setTimeout(function () {\n        self.repaint();\n      }, 5000);\n      this.setState({\n        repaintDelay: myTimeout\n      });\n    }\n  }\n\n  componentWillUnmount() {\n    /* kill any pending background threads that were\n    invoked in componentDidMount(). */\n    clearTimeout(this.state.repaintDelay);\n    clearTimeout(this.state.logosDelay);\n  }\n\n  shouldComponentUpdate(nextProps, nextState) {\n    /* Potentially veto React's decisions to update the \n    component, calling render() */\n    console.log(\"shouldComponentUpdate()\", this.state.shouldRender);\n    return this.state.shouldRender;\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      key: \"logo-cube\",\n      className: \"d3-container mt-0\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 261,\n        columnNumber: 13\n      }\n    }, !this.state.shouldRender ? /*#__PURE__*/React.createElement(\"div\", {\n      className: \"mt-5 pt-5\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 263,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(Loading, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 264,\n        columnNumber: 21\n      }\n    })) : /*#__PURE__*/React.createElement(\"div\", {\n      className: \"d3-cube mt-5\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 267,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(CubeSide, {\n      side: \"top\",\n      url: this.getBackgroundUrl(\"top\"),\n      classes: \"fade-in\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 268,\n        columnNumber: 21\n      }\n    }), /*#__PURE__*/React.createElement(CubeSide, {\n      side: \"bottom\",\n      url: this.getBackgroundUrl(\"bottom\"),\n      classes: \"fade-in\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 269,\n        columnNumber: 21\n      }\n    }), /*#__PURE__*/React.createElement(CubeSide, {\n      side: \"front\",\n      url: this.getBackgroundUrl(\"front\"),\n      classes: \"grow-side\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 270,\n        columnNumber: 21\n      }\n    }), /*#__PURE__*/React.createElement(CubeSide, {\n      side: \"back\",\n      url: this.getBackgroundUrl(\"back\"),\n      classes: \"grow-side\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 271,\n        columnNumber: 21\n      }\n    }), /*#__PURE__*/React.createElement(CubeSide, {\n      side: \"right\",\n      url: this.getBackgroundUrl(\"right\"),\n      classes: \"grow-side\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 272,\n        columnNumber: 21\n      }\n    }), /*#__PURE__*/React.createElement(CubeSide, {\n      side: \"left\",\n      url: this.getBackgroundUrl(\"left\"),\n      classes: \"grow-side\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 273,\n        columnNumber: 21\n      }\n    })));\n  }\n\n  repaint() {\n    /* place a random logo on a random side at a random point in time. */\n    var self = this;\n    const side = self.getRandomSide();\n    const logos = side === \"front\" ? self.state.featured_logos : self.state.logos;\n    const logo = self.getRandomLogo(logos);\n    const elapsed = self.getElapsedTime(side);\n\n    if (side != null && elapsed > 3000) {\n      self.setBackgroundUrl(side, logo);\n    }\n\n    setTimeout(function () {\n      self.repaint();\n    }, 1000 * Math.random());\n  }\n  /* ---------------------------------------------------------------\n      Hereon, the drudgerous grind of working with a six-sided object.  \n   * --------------------------------------------------------------- */\n\n\n  getBackgroundUrl(side) {\n    let retval;\n\n    switch (side) {\n      case \"top\":\n        retval = this.state.cubeTopBackgroundUrl;\n        break;\n\n      case \"bottom\":\n        retval = this.state.cubeBottomBackgroundUrl;\n        break;\n\n      case \"left\":\n        retval = this.state.cubeLeftBackgroundUrl;\n        break;\n\n      case \"right\":\n        retval = this.state.cubeRightBackgroundUrl;\n        break;\n\n      case \"front\":\n        retval = this.state.cubeFrontBackgroundUrl;\n        break;\n\n      case \"back\":\n        retval = this.state.cubeBackBackgroundUrl;\n        break;\n\n      default:\n        retval = null;\n        break;\n    }\n\n    return retval;\n  }\n\n  setBackgroundUrl(side, url) {\n    let state;\n\n    switch (side) {\n      case \"top\":\n        state = {\n          cubeTopBackgroundUrl: url\n        };\n        break;\n\n      case \"bottom\":\n        state = {\n          cubeBottomBackgroundUrl: url\n        };\n        break;\n\n      case \"left\":\n        state = {\n          cubeLeftBackgroundUrl: url\n        };\n        break;\n\n      case \"right\":\n        state = {\n          cubeRightBackgroundUrl: url\n        };\n        break;\n\n      case \"front\":\n        state = {\n          cubeFrontBackgroundUrl: url\n        };\n        break;\n\n      case \"back\":\n        state = {\n          cubeBackBackgroundUrl: url\n        };\n        break;\n\n      default:\n        state = {};\n        break;\n    }\n\n    this.setState(state, () => {\n      this.resetElapsedTime(side);\n    });\n  }\n\n  resetElapsedTime(side) {\n    const d = new Date();\n    let state;\n\n    switch (side) {\n      case \"top\":\n        state = {\n          cubeTop: d\n        };\n        break;\n\n      case \"bottom\":\n        state = {\n          cubeBottom: d\n        };\n        break;\n\n      case \"left\":\n        state = {\n          cubeLeft: d\n        };\n        break;\n\n      case \"right\":\n        state = {\n          cubeRight: d\n        };\n        break;\n\n      case \"front\":\n        state = {\n          cubeFront: d\n        };\n        break;\n\n      case \"back\":\n        state = {\n          cubeBack: d\n        };\n        break;\n\n      default:\n        state = {};\n        break;\n    }\n\n    this.setState(state);\n  }\n\n  getElapsedTime(side) {\n    const d = new Date();\n\n    switch (side) {\n      case \"top\":\n        return d - this.state.cubeTop;\n\n      case \"bottom\":\n        return d - this.state.cubeBottom;\n\n      case \"left\":\n        return d - this.state.cubeLeft;\n\n      case \"right\":\n        return d - this.state.cubeRight;\n\n      case \"front\":\n        return d - this.state.cubeFront;\n\n      case \"back\":\n        return d - this.state.cubeBack;\n\n      default:\n        return d - this.state.constructed;\n    }\n  }\n\n  getSerializedLogo(logos, i) {\n    /* this handles the hopefully-rare case\n    where I might stupidly neglect to have 6 more\n    featured logos in the Wordpress api. */\n    if (i < logos.length) {\n      return logos[i];\n    }\n  }\n\n  isLogoCollision(logo) {\n    switch (logo) {\n      case this.state.cubeTopBackgroundUrl:\n      case this.state.cubeBottomBackgroundUrl:\n      case this.state.cubeBackBackgroundUrl:\n      case this.state.cubeFrontBackgroundUrl:\n      case this.state.cubeLeftBackgroundUrl:\n      case this.state.cubeRightBackgroundUrl:\n        return true;\n\n      default:\n        return false;\n    }\n  }\n\n  getRandomLogo(logos) {\n    var logo,\n        i = 0;\n\n    do {\n      logo = logos[Math.floor(Math.random() * logos.length)];\n      i++;\n    } while (this.isLogoCollision(logo) && i <= logos.length);\n\n    return logo;\n  }\n\n  getRandomSide() {\n    const side = Math.floor(Math.random() * 6);\n\n    switch (side) {\n      case 0:\n        return \"top\";\n\n      case 1:\n        return \"bottom\";\n\n      case 2:\n        return \"left\";\n\n      case 3:\n        return \"right\";\n\n      case 4:\n        return \"front\";\n\n      case 5:\n        return \"back\";\n\n      default:\n        return null;\n    }\n  }\n\n}\n\nexport default LogoCube;\n\nconst CubeSide = props => {\n  const clsId = \"d3-side \" + props.side + \" \" + props.classes;\n  const divId = \"cube-\" + props.side + \"-logo-div\";\n  const divStyle = {\n    backgroundImage: \"url('\" + props.url + \"')\"\n  };\n  return /*#__PURE__*/React.createElement(React.Fragment, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 424,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    key: divId,\n    className: clsId,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 425,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 427,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    key: divId + \"-logo\",\n    className: \"logo\",\n    style: divStyle,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 428,\n      columnNumber: 21\n    }\n  }))));\n};","map":{"version":3,"sources":["/Users/mcdaniel/github/lpm0073/lawrencemcdaniel.com/site/src/components/logoCube/Component.js"],"names":["React","Component","wpGetFeaturedImage","Loading","LogoCube","constructor","props","d","Date","logos","items","map","post","indx","featured_logos","filter","i","categories","length","featuredPost","state","cubeTopBackgroundUrl","cubeBottomBackgroundUrl","cubeLeftBackgroundUrl","cubeRightBackgroundUrl","cubeFrontBackgroundUrl","cubeBackBackgroundUrl","repaintDelay","logosDelay","shouldRender","constructed","cubeTop","cubeBottom","cubeLeft","cubeRight","cubeFront","cubeBack","resetElapsedTime","bind","getElapsedTime","getBackgroundUrl","setBackgroundUrl","getRandomSide","getRandomLogo","getSerializedLogo","isLogoCollision","repaint","componentDidMount","self","myTimeout","setTimeout","setState","isLoading","componentWillUnmount","clearTimeout","shouldComponentUpdate","nextProps","nextState","console","log","render","side","logo","elapsed","Math","random","retval","url","floor","CubeSide","clsId","classes","divId","divStyle","backgroundImage"],"mappings":"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","sourcesContent":["/*\n    Renders a spinning cube that shows random collections of logos that randomly\n    update at random intervals. Logos are provided by a REST api that is \n    managed by Redux.\n    \n    Logos API: https://api.lawrencemcdaniel.com/wp-json/wp/v2/posts?categories=43&_embed&per_page=100\n\n    The cube, which is pure CSS and HTML, was scaffolded from a D3 example that I liked, created by Noah Veltman. \n    Ironically, the D3 source code itself wasn't useful. I encountered a variety of challenges with using D3.js for this component. \n    Though all of these challenges were solvable, in the end it was most practical to leave the DOM manipulations to ReactJS. \n    You can review the GitHub commit history of this file to see the early versions of this component implemented with D3.js\n\n    Noah's original cube: https://bl.ocks.org/veltman/4c989172ac2f820b0b7267c53cb96975 \n    \n\n    The component life cycle is as follows:\n    =================================================\n\n    1. Animated cube rendering (1000 ms):\n    This is intended to distract the site visitor for a moment while we pre-fetch the first set\n    of logo images (for slow internet connections).\n\n    2. Initial logo display (5000 ms):\n    Display six \"featured\" logos (one per cube side) that I most want visitors to see.\n    (React, Redux, Angular, Django, AWS, Wordpress)\n\n    3. Update infinitely:\n    Randomly show lots of other logos. The longer the site visitor stares at this logo cube\n    the better, because it buys time for the image pre-fetcher to download more \n    site content in the background. Don't be impressed however, I stole this idea from nytimes.com\n\n\n    Some of the challenges, and their solutions:\n    =================================================\n    A. Lack of impact\n    The logo cube is supposed to be a creative way of showcasing my most important\n    (self-proclaimed) technology skills to site visitors. Most visitors however,\n    will only see the cube for a couple of seconds and then move on to some other page.\n    Thus, a random selection of logos works at cross purposes to this design objective since \n    most of the logos pertain to lesser-known supporting technologies.\n\n    solution: I created a 2nd api feed consisting of six \"featured\" logos.\n    I initialize the cube with the featured logos, and then hold these\n    logos in place for 5 seconds before initiating the random logo replacements.\n    \n    B. Disappointing logo shuffle.\n    It bothered me that sometimes all six cube sides would display only\n    the logos of unimpressive technologies for an extended period of time.\n    I found myself staring at the cube anxiously waiting for a \"good\" \n    logo to appear.\n\n    solution: \n    I reserve one of the six cube sides for exclusively displaying\n    one of the six featured logos.\n\n    C. Reverse Rotation (aka \"Wagon Wheel\" Effect)\n    I had trouble visually tracking the motion of the original version of the cube's spinning animations.\n    The cube would sometimes appear to be spinning left-to-right, and other times right-to-left. In\n    the latter cases the cube appeared mal-constructed and disfigured. Here's a technical explanation\n    of the nature of this problem: https://en.wikipedia.org/wiki/Wagon-wheel_effect\n\n    solution:\n    First, i tinkered with the opacity of the cube sides so that the side that is supposed to be in front is brighter, \n    and the reverse side is darker. Secondly, adding the cube rendering helped a lot because the cube begins\n    as a 2-dimensional spinning square, which afterwards grows to become a cube. The 2D spinning image is easier for your\n    visual cortex to process, and the growth animation provides a way for your mind to bootstrap and retain what's\n    happening on-screen.\n\n    D. Screen flicker. \n    React mounts/unmounts components multiple times, often for \n    reasons that are external to the component. React also calls render()\n    several times during normal component initialization. Both of these are \n    problems for CSS animations because these end up getting killed in mid-animation and\n    restarted multiple times (ie screen flicker), which looks terrible.\n\n    solution: I fixed the screen flicker with a few different kinds of timers\n    that are intended to delay rendering the cube (and thus initiating the CSS\n    animations) until React has had enough time to get the home screen \n    completely setup.\n\n    E. Erratic Logo updates. \n    Logos change at random intervals. However, it looks bad if a logo is replaced too quickly. \n\n    solution: I added 6 timers to track the elapsed lifetime of each logo,\n    and then I only replace a logo if its been visible for a minimum\n    length of time.\n\n    F. Orphan Threads.\n    Launching the painter() method with a timer delay is tricky\n    because it is initiated on a new asynchronous background thread.\n    When the component mounts/unmounts very quickly, the threads lives on,\n    resulting in several painter() threads co-existing, which causes\n    the cube to update multitudes more frequently than I wanted.\n\n    solution: I fixed the threading issue by keeping track of, and explicitly killing \n    all background threads that I create.\n\n    G. Slow loading logos.\n    The cube itself is rendered purely in CSS and so always renders smoothly, but it\n    depends on a collection of around 75 logo images provided by the\n    REST api via Redux. On a slow internet connection you could see each new logo\n    downloading on the cube side, which looked terrible. \n\n    solution: i setup an image pre-fetcher inside of Redux, not just for\n    this logo cube but for the hundreds of other images on this site as\n    well.\n\n    H. Duplicate logos\n    It bothered me that the same logo would sometimes appears on two (or more)\n    sides.\n\n    solution: i added some \"no collision\" logic to prevent the random logo\n    selector from choosing any logos that are currently being displayed.\n\n*/\nimport React, { Component } from 'react';\nimport { wpGetFeaturedImage } from '../../shared/wpGetFeaturedImage';\nimport './styles.css';\nimport Loading from '../Loading';\n\n\nclass LogoCube extends Component {\n\n    constructor(props) {\n        super(props);\n\n        var d = new Date();\n\n        /* Logo urls from Redux */\n        const logos =  this.props.logos.items.map((post, indx) => {\n            /* \n            image list is managed by a Wordpress api and a custom\n            plugin that a) web-optimizes images b) uploads images to\n            the CDN, and c) creates a collection of alternative \n            image sizes. The rest api therefore returns\n            many possible URL's for each URL. wpGetFeaturedImage()\n            sifts through the list to choose the best image for our\n            particular need.\n             */\n            return wpGetFeaturedImage(post, null);\n        });\n\n        /* I flagged six images in Wordpress that I want displayed\n        when the cube first renders. */\n        const featured_logos =  this.props.logos.items.filter((post, indx) => {\n            for (var i=0 ; i < post.categories.length ; i++) {\n                if (post.categories[i] === 48) {  /* featured technology */\n                    return true;\n                }\n            }\n            return false;\n        }).map((featuredPost, indx) => {\n            return wpGetFeaturedImage(featuredPost, null);\n        });\n\n        this.state = {\n            /* logo lists */\n            logos: logos,\n            featured_logos: featured_logos,\n\n            /* the current logo image URL for each of the 6 logos */\n            cubeTopBackgroundUrl: null,\n            cubeBottomBackgroundUrl: null,\n            cubeLeftBackgroundUrl: null,\n            cubeRightBackgroundUrl: null,\n            cubeFrontBackgroundUrl: null,\n            cubeBackBackgroundUrl: null,\n\n            /* delay threads, to prevent the component from re-rendering if we're in mid-animation */\n            repaintDelay: null,\n            logosDelay: null,\n            shouldRender: false, /* allow updates while the \"Loading\" spinner is present */\n\n            /* time stamps to track elapsed time of each logo image */\n            constructed: d,\n            cubeTop: d,\n            cubeBottom: d,\n            cubeLeft: d,\n            cubeRight: d,\n            cubeFront: d,\n            cubeBack: d\n\n          };\n\n        this.resetElapsedTime = this.resetElapsedTime.bind(this);\n        this.getElapsedTime = this.getElapsedTime.bind(this);\n        this.getBackgroundUrl = this.getBackgroundUrl.bind(this);\n        this.setBackgroundUrl = this.setBackgroundUrl.bind(this);\n        this.getRandomSide = this.getRandomSide.bind(this);\n        this.getRandomLogo = this.getRandomLogo.bind(this);\n        this.getSerializedLogo = this.getSerializedLogo.bind(this);\n        this.isLogoCollision = this.isLogoCollision.bind(this);\n        this.repaint = this.repaint.bind(this);\n        }\n\n\n    componentDidMount() {\n        var self = this;\n        /* this is a general purpose moratorium on React\n        updates for the first 50ms of the component's\n        life cycle. From visual inspection in the \n        JS console this prevents the first dozen or\n        so calls to render(), which is what cause the\n        screen flicker. */\n        var myTimeout = setTimeout(function() {\n            if (!self.state.shouldRender) {\n                self.setState({shouldRender: true});\n            }\n        }, 50);    \n\n        /*\n            Note: componentDidMount() gets called a half dozen times bc the Home component\n            which instantiates this component itself mounts and unmounts multiple times.\n\n            we therefore delay the first repaint for a while. however\n            we also have to keep track of the repaint() threads that we invoke so that \n            we can kill them in cases where the component mounts and then quickly unmounts.\n         */\n        if (!this.props.logos.isLoading) {\n\n\n            /* This is intended to create a small dramatic delay between the initial\n            cube-rendering animation and the presentation of the first set of logos. */\n            myTimeout = setTimeout(function() {\n                self.setBackgroundUrl(\"left\", self.getSerializedLogo(self.state.featured_logos, 0));                \n                self.setBackgroundUrl(\"right\", self.getSerializedLogo(self.state.featured_logos, 1));                \n                self.setBackgroundUrl(\"top\", self.getSerializedLogo(self.state.featured_logos, 2));\n                self.setBackgroundUrl(\"bottom\", self.getSerializedLogo(self.state.featured_logos, 3));                \n                self.setBackgroundUrl(\"front\", self.getSerializedLogo(self.state.featured_logos, 4));                \n                self.setBackgroundUrl(\"back\", self.getSerializedLogo(self.state.featured_logos, 5));\n            }, 500);\n            self.setState({logosDelay: myTimeout});\n\n            /* Begin random logo updates after a 5-second initial delay */\n            myTimeout = setTimeout(function() {\n                self.repaint();\n            }, 5000);    \n            this.setState({repaintDelay: myTimeout});\n    \n        }   \n\n    }\n\n    componentWillUnmount() {\n        /* kill any pending background threads that were\n        invoked in componentDidMount(). */\n        clearTimeout(this.state.repaintDelay);\n        clearTimeout(this.state.logosDelay);\n    }\n    \n    shouldComponentUpdate(nextProps, nextState) {\n        /* Potentially veto React's decisions to update the \n        component, calling render() */\n        console.log(\"shouldComponentUpdate()\", this.state.shouldRender)\n        return this.state.shouldRender;\n    }\n\n    render() {\n\n        return(\n            <div key=\"logo-cube\" className=\"d3-container mt-0\">\n            {(!this.state.shouldRender) ? (\n                <div className=\"mt-5 pt-5\">\n                    <Loading />\n                </div>\n              ) : (\n                <div className=\"d3-cube mt-5\">\n                    <CubeSide side=\"top\" url={this.getBackgroundUrl(\"top\")} classes=\"fade-in\" />\n                    <CubeSide side=\"bottom\" url={this.getBackgroundUrl(\"bottom\")} classes=\"fade-in\" />\n                    <CubeSide side=\"front\" url={this.getBackgroundUrl(\"front\")} classes=\"grow-side\"/>\n                    <CubeSide side=\"back\" url={this.getBackgroundUrl(\"back\")} classes=\"grow-side\" />\n                    <CubeSide side=\"right\" url={this.getBackgroundUrl(\"right\")} classes=\"grow-side\" />\n                    <CubeSide side=\"left\" url={this.getBackgroundUrl(\"left\")} classes=\"grow-side\" />\n                </div>\n              )}\n            </div>\n        );\n    }\n\n    repaint() {\n        /* place a random logo on a random side at a random point in time. */\n        var self = this;\n\n        const side = self.getRandomSide();\n        const logos = (side === \"front\") ? self.state.featured_logos: self.state.logos;\n        const logo = self.getRandomLogo(logos);\n        const elapsed = self.getElapsedTime(side);\n        if (side != null && elapsed > 3000) {\n            self.setBackgroundUrl(side, logo);\n        }\n    \n        setTimeout(function() {\n            self.repaint();\n        }, 1000 * Math.random());   \n      \n    }\n\n    /* ---------------------------------------------------------------\n        Hereon, the drudgerous grind of working with a six-sided object.  \n     * --------------------------------------------------------------- */\n    getBackgroundUrl(side) {\n        let retval;\n        switch(side) {\n            case \"top\": retval = this.state.cubeTopBackgroundUrl; break;\n            case \"bottom\": retval =  this.state.cubeBottomBackgroundUrl; break;\n            case \"left\": retval =  this.state.cubeLeftBackgroundUrl; break;\n            case \"right\": retval =  this.state.cubeRightBackgroundUrl; break;\n            case \"front\": retval =  this.state.cubeFrontBackgroundUrl; break;\n            case \"back\": retval =  this.state.cubeBackBackgroundUrl; break;\n            default: retval = null; break;\n        }\n        return retval;\n    }\n\n    setBackgroundUrl(side, url) {\n\n        let state;\n        switch(side) {\n            case \"top\": state = {cubeTopBackgroundUrl: url}; break;\n            case \"bottom\": state = {cubeBottomBackgroundUrl: url}; break;\n            case \"left\": state = {cubeLeftBackgroundUrl: url}; break;\n            case \"right\": state = {cubeRightBackgroundUrl: url}; break;\n            case \"front\": state = {cubeFrontBackgroundUrl: url}; break;\n            case \"back\": state = {cubeBackBackgroundUrl: url}; break;\n            default: state = {}; break;\n        }\n        this.setState(state, () => {\n            this.resetElapsedTime(side);\n        });\n\n    }\n\n    resetElapsedTime(side) {\n        const d = new Date();\n        let state;\n        switch(side) {\n            case \"top\": state = {cubeTop: d}; break;\n            case \"bottom\": state = {cubeBottom: d}; break;\n            case \"left\":state = {cubeLeft: d}; break;\n            case \"right\": state = {cubeRight: d}; break;\n            case \"front\": state = {cubeFront: d}; break;\n            case \"back\": state = {cubeBack: d}; break;\n            default: state = {}; break;\n        }\n        this.setState(state);\n\n    }\n\n    getElapsedTime(side) {\n        const d = new Date();\n        switch(side) {\n            case \"top\": return d - this.state.cubeTop;\n            case \"bottom\": return d - this.state.cubeBottom;\n            case \"left\": return d - this.state.cubeLeft;\n            case \"right\": return d - this.state.cubeRight;\n            case \"front\": return d - this.state.cubeFront;\n            case \"back\": return d - this.state.cubeBack;\n            default: return d - this.state.constructed;\n        }\n    }\n      \n    getSerializedLogo(logos, i) {\n        /* this handles the hopefully-rare case\n        where I might stupidly neglect to have 6 more\n        featured logos in the Wordpress api. */\n        if (i < logos.length) {\n            return logos[i];\n        }\n    }\n    isLogoCollision(logo) {\n\n        switch (logo) {\n            case this.state.cubeTopBackgroundUrl:\n            case this.state.cubeBottomBackgroundUrl:\n            case this.state.cubeBackBackgroundUrl:\n            case this.state.cubeFrontBackgroundUrl:\n            case this.state.cubeLeftBackgroundUrl:\n            case this.state.cubeRightBackgroundUrl:\n                return true;\n            default:\n                return false;\n        }\n\n    }\n\n    getRandomLogo(logos) {\n        var logo, i = 0;\n        do {\n            logo = logos[Math.floor(Math.random() * logos.length)];\n            i++;\n        } while (this.isLogoCollision(logo) && (i <= logos.length))\n        return logo;\n    }\n\n    \n    getRandomSide() {\n\n        const side = Math.floor(Math.random() * 6);\n        switch(side) {\n            case 0: return \"top\";\n            case 1: return \"bottom\";\n            case 2: return \"left\";\n            case 3: return \"right\";\n            case 4: return \"front\";\n            case 5: return \"back\";\n            default: return null;\n        }\n    \n    }\n    \n}\n\nexport default LogoCube;\n\nconst CubeSide = (props) => {\n\n    const clsId = \"d3-side \" + props.side + \" \" + props.classes;\n    const divId = \"cube-\" + props.side + \"-logo-div\";\n    const divStyle = {\n        backgroundImage: \"url('\" + props.url + \"')\"\n      }\n\n    return(\n        <React.Fragment >\n            <div key={divId}\n                 className={clsId}>\n                <div>\n                    <div key={divId+\"-logo\"} className=\"logo\" \n                        style={divStyle}>\n                    </div>\n                </div>\n            </div>\n        </React.Fragment>\n    );\n}"]},"metadata":{},"sourceType":"module"}